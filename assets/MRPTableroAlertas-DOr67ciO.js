import{b as se,r as c,d as B,j as e,Q as re,P as F,v as E,C as U,n as I,p as te,q as ae,m as f}from"./index-DSailSuQ.js";import{P as oe}from"./PageHeader-YH3gAQyl.js";import{C as q,a as D,b as K,c as Q}from"./Card-DuU2GO_U.js";import{X as V}from"./x-circle-CUJIA21-.js";import{A as z}from"./alert-circle-7AkYIq0l.js";import{I as X}from"./info-D6z4HOD_.js";import{F as ce}from"./filter-DdPPHaAz.js";import{C as H}from"./chevron-up-CyyOK-28.js";import{L as le}from"./loader-2-DH2yhz0D.js";function ne({estado:r,clase:h}){const m={danger:{bg:"bg-red-500/20",text:"text-red-400",icon:V},warning:{bg:"bg-yellow-500/20",text:"text-yellow-400",icon:E},success:{bg:"bg-green-500/20",text:"text-green-400",icon:U},info:{bg:"bg-blue-500/20",text:"text-blue-400",icon:X}},{bg:x,text:i,icon:N}=m[h]||m.info;return e.jsxs("span",{className:f("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium",x,i),children:[e.jsx(N,{className:"w-3.5 h-3.5"}),r]})}function g({titulo:r,valor:h,icon:m,color:x}){const i={danger:"text-red-400 bg-red-500/10 border-red-500/30",warning:"text-yellow-400 bg-yellow-500/10 border-yellow-500/30",success:"text-green-400 bg-green-500/10 border-green-500/30",info:"text-blue-400 bg-blue-500/10 border-blue-500/30",primary:"text-[var(--primary)] bg-[var(--primary)]/10 border-[var(--primary)]/30"};return e.jsx("div",{className:f("rounded-xl border p-4",i[x]||i.primary),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:f("p-2 rounded-lg",i[x]||i.primary),children:e.jsx(m,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:h}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:r})]})]})})}function je(){var L,T,R;const{t:r}=se(),[h,m]=c.useState(!0),[x,i]=c.useState(null),[N,$]=c.useState([]),[u,G]=c.useState({}),[o,_]=c.useState({total:0,limit:50,offset:0,has_more:!1}),[a,b]=c.useState({centro:"",almacen:"",sector:"",estado:""}),[w,J]=c.useState({centros:[],almacenes:[],sectores:[]}),[k,O]=c.useState(!0),[p,W]=c.useState({key:null,direction:"asc"}),[v,Y]=c.useState("");c.useEffect(()=>{(async()=>{var t,n;try{const l=await B.get("/mrp/catalogos");(t=l.data)!=null&&t.ok&&(J(l.data),((n=l.data.centros)==null?void 0:n.length)>0&&b(y=>({...y,centro:l.data.centros[0].codigo})))}catch(l){console.error("Error loading catalogos:",l)}})()},[]);const C=c.useCallback(async()=>{var s,t,n,l,y,M;if(a.centro){m(!0),i(null);try{const d=new URLSearchParams;a.centro&&d.append("centro",a.centro),a.almacen&&d.append("almacen",a.almacen),a.sector&&d.append("sector",a.sector),a.estado&&d.append("estado",a.estado),d.append("limit",o.limit),d.append("offset",o.offset);const j=await B.get(`/mrp/alertas?${d.toString()}`);(s=j.data)!=null&&s.ok?($(j.data.data||[]),G(j.data.resumen||{}),_(ee=>({...ee,...j.data.pagination}))):i(((n=(t=j.data)==null?void 0:t.error)==null?void 0:n.message)||"Error al cargar alertas")}catch(d){i(((M=(y=(l=d.response)==null?void 0:l.data)==null?void 0:y.error)==null?void 0:M.message)||"Error de conexión")}finally{m(!1)}}},[a,o.limit,o.offset]);c.useEffect(()=>{C()},[C]);const S=[...N].sort((s,t)=>{if(!p.key)return 0;const n=s[p.key],l=t[p.key];return n<l?p.direction==="asc"?-1:1:n>l?p.direction==="asc"?1:-1:0}).filter(s=>v===""||s.codigo.toLowerCase().includes(v.toLowerCase())||s.descripcion.toLowerCase().includes(v.toLowerCase())),A=s=>{W(t=>({key:s,direction:t.key===s&&t.direction==="asc"?"desc":"asc"}))},P=({columnKey:s})=>p.key!==s?null:p.direction==="asc"?e.jsx(H,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}),Z=[{value:"",label:"Todos"},{value:"quiebre",label:"Quiebre de Stock"},{value:"bajo punto",label:"Bajo Punto de Pedido"},{value:"bajo stock",label:"Bajo Stock de Seguridad"},{value:"exceso",label:"Exceso/Sobrestock"},{value:"normal",label:"Normal"}];return e.jsxs(re,{children:[e.jsx(oe,{title:r("mrp_alertas_titulo","Tablero de Alertas MRP"),subtitle:r("mrp_alertas_subtitulo","Estado general de materiales planificados")}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(g,{titulo:r("mrp_total","Total Materiales"),valor:u.total||0,icon:F,color:"primary"}),e.jsx(g,{titulo:r("mrp_quiebre","Quiebre de Stock"),valor:u.quiebre_stock||0,icon:V,color:"danger"}),e.jsx(g,{titulo:r("mrp_bajo_pp","Bajo Punto Pedido"),valor:u.bajo_punto_pedido||0,icon:E,color:"warning"}),e.jsx(g,{titulo:r("mrp_bajo_ss","Bajo Stock Seg."),valor:u.bajo_stock_seguridad||0,icon:z,color:"warning"}),e.jsx(g,{titulo:r("mrp_sobrestock","Sobrestock"),valor:u.sobrestock||0,icon:X,color:"info"}),e.jsx(g,{titulo:r("mrp_normal","Normal"),valor:u.normal||0,icon:U,color:"success"})]}),e.jsxs(q,{className:"mb-6",children:[e.jsx(D,{className:"cursor-pointer",onClick:()=>O(!k),children:e.jsxs(K,{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5 text-[var(--primary)]"}),r("mrp_filtros","Filtros")]}),k?e.jsx(H,{className:"w-5 h-5"}):e.jsx(I,{className:"w-5 h-5"})]})}),k&&e.jsxs(Q,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:[r("mrp_centro","Centro")," *"]}),e.jsxs("select",{value:a.centro,onChange:s=>b(t=>({...t,centro:s.target.value})),className:"w-full px-3 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Seleccionar..."}),(L=w.centros)==null?void 0:L.map(s=>e.jsxs("option",{value:s.codigo,children:[s.codigo," - ",s.nombre]},s.codigo))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:r("mrp_almacen","Almacén")}),e.jsxs("select",{value:a.almacen,onChange:s=>b(t=>({...t,almacen:s.target.value})),className:"w-full px-3 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),(T=w.almacenes)==null?void 0:T.map(s=>e.jsxs("option",{value:s.codigo,children:[s.codigo," - ",s.nombre]},s.codigo))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:r("mrp_sector","Sector")}),e.jsxs("select",{value:a.sector,onChange:s=>b(t=>({...t,sector:s.target.value})),className:"w-full px-3 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos"}),(R=w.sectores)==null?void 0:R.map(s=>e.jsx("option",{value:s.nombre,children:s.nombre},s.nombre))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:r("mrp_estado","Estado")}),e.jsx("select",{value:a.estado,onChange:s=>b(t=>({...t,estado:s.target.value})),className:"w-full px-3 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent",children:Z.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:r("mrp_buscar","Buscar")}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[var(--fg-muted)]"}),e.jsx("input",{type:"text",value:v,onChange:s=>Y(s.target.value),placeholder:"Código o descripción...",className:"w-full pl-10 pr-3 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-transparent"})]})]})]}),e.jsx("div",{className:"flex justify-end mt-4",children:e.jsxs("button",{onClick:C,className:"flex items-center gap-2 px-4 py-2 bg-[var(--primary)] text-[var(--on-primary)] rounded-lg hover:bg-[var(--primary-bright)] transition-colors",children:[e.jsx(ae,{className:"w-4 h-4"}),r("mrp_actualizar","Actualizar")]})})]})]}),e.jsxs(q,{children:[e.jsx(D,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-[var(--primary)]"}),r("mrp_lista_alertas","Lista de Alertas"),e.jsxs("span",{className:"ml-2 text-sm font-normal text-[var(--fg-muted)]",children:["(",S.length," materiales)"]})]})}),e.jsxs(Q,{children:[h?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"w-8 h-8 animate-spin text-[var(--primary)]"})}):x?e.jsxs("div",{className:"flex items-center justify-center py-12 text-red-400",children:[e.jsx(z,{className:"w-6 h-6 mr-2"}),x]}):S.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-[var(--fg-muted)]",children:[e.jsx(F,{className:"w-12 h-12 mb-4 opacity-50"}),e.jsx("p",{children:r("mrp_sin_alertas","No hay alertas para mostrar")}),e.jsx("p",{className:"text-sm",children:r("mrp_seleccionar_centro","Seleccione un centro para ver alertas")})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)]",children:[e.jsx("th",{className:"px-4 py-3 text-left cursor-pointer hover:bg-[var(--surface)] transition-colors",onClick:()=>A("codigo"),children:e.jsxs("span",{className:"flex items-center gap-1",children:[r("mrp_col_codigo","Código SAP"),e.jsx(P,{columnKey:"codigo"})]})}),e.jsx("th",{className:"px-4 py-3 text-left",children:r("mrp_col_descripcion","Descripción")}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_demanda","Demanda Anual")}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_ss","Stock Seg.")}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_pp","Pto. Pedido")}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_smax","Stock Máx.")}),e.jsx("th",{className:"px-4 py-3 text-center cursor-pointer hover:bg-[var(--surface)] transition-colors",onClick:()=>A("stock_actual"),children:e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[r("mrp_col_stock","Stock Actual"),e.jsx(P,{columnKey:"stock_actual"})]})}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_pedidos","Pedidos Curso")}),e.jsx("th",{className:"px-4 py-3 text-center cursor-pointer hover:bg-[var(--surface)] transition-colors",onClick:()=>A("rotacion_pct"),children:e.jsxs("span",{className:"flex items-center justify-center gap-1",children:[r("mrp_col_rotacion","Rotación %"),e.jsx(P,{columnKey:"rotacion_pct"})]})}),e.jsx("th",{className:"px-4 py-3 text-center",children:r("mrp_col_estado","Estado")}),e.jsx("th",{className:"px-4 py-3 text-left",children:r("mrp_col_sugerencia","Sugerencia")})]})}),e.jsx("tbody",{children:S.map((s,t)=>{var n;return e.jsxs("tr",{className:f("border-b border-[var(--border)] hover:bg-[var(--surface)] transition-colors",t%2===0?"bg-[var(--bg)]":"bg-[var(--surface)]"),children:[e.jsx("td",{className:"px-4 py-3 font-mono text-[var(--primary)]",children:s.codigo}),e.jsx("td",{className:"px-4 py-3 max-w-xs truncate",title:s.descripcion,children:s.descripcion}),e.jsx("td",{className:"px-4 py-3 text-center",children:(n=s.demanda_estimada_anual)==null?void 0:n.toLocaleString()}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.stock_seguridad}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.punto_pedido}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.stock_maximo}),e.jsx("td",{className:f("px-4 py-3 text-center font-medium",s.stock_actual<=0?"text-red-400":s.stock_actual<s.punto_pedido?"text-yellow-400":"text-green-400"),children:s.stock_actual}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.pedidos_en_curso}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:f("font-medium",s.rotacion_pct>300?"text-green-400":s.rotacion_pct>100?"text-yellow-400":"text-red-400"),children:[s.rotacion_pct,"%"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx(ne,{estado:s.estado,clase:s.estado_clase})}),e.jsx("td",{className:"px-4 py-3 text-sm text-[var(--fg-muted)] max-w-xs truncate",title:s.sugerencia,children:s.sugerencia||"-"})]},s.codigo)})})]})}),o.total>o.limit&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-[var(--border)]",children:[e.jsxs("span",{className:"text-sm text-[var(--fg-muted)]",children:["Mostrando ",o.offset+1," - ",Math.min(o.offset+o.limit,o.total)," de ",o.total]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(s=>({...s,offset:Math.max(0,s.offset-s.limit)})),disabled:o.offset===0,className:"px-3 py-1 rounded-lg border border-[var(--border)] text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--surface)]",children:"Anterior"}),e.jsx("button",{onClick:()=>_(s=>({...s,offset:s.offset+s.limit})),disabled:!o.has_more,className:"px-3 py-1 rounded-lg border border-[var(--border)] text-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-[var(--surface)]",children:"Siguiente"})]})]})]})]})]})}export{je as default};
