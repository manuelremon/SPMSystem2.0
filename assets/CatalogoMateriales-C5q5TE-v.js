import{b as Ne,r as o,j as e,X as _e,P as ne,p as ye,B as Se,z as ue,K as we,T as de,N as Ce,O as ke}from"./index-DSailSuQ.js";import{m as q,e as De}from"./spm-BFWwVGn1.js";import{f as L,a as Pe}from"./formatters-B3FH-qkk.js";import{I as R}from"./Input-C0tGZyv5.js";import{C as me,c as xe,a as Me,b as Te}from"./Card-DuU2GO_U.js";import{A as Ee}from"./Alert-DnMC6g2-.js";import{P as Ae}from"./PageHeader-YH3gAQyl.js";import{M as Be}from"./Modal-B5O43XTM.js";import{B as k}from"./Badge-BlsFmz_R.js";import{T as qe}from"./Skeleton-SF9Xco25.js";import{L as C}from"./loader-2-DH2yhz0D.js";import"./info-D6z4HOD_.js";import"./alert-circle-7AkYIq0l.js";import"./x-circle-CUJIA21-.js";import"./check-circle-BdkCzlrZ.js";const $=300,Le=100;function U(a,r){const[m,x]=o.useState(a);return o.useEffect(()=>{const u=setTimeout(()=>x(a),r);return()=>clearTimeout(u)},[a,r]),m}function ea(){var G,J,Q,W,Y,Z,ee,ae,se,te,oe,re,ce;const{t:a}=Ne(),[r,m]=o.useState(""),[x,u]=o.useState(""),[p,j]=o.useState(""),g=U(r,$),D=U(x,$),P=U(p,$),[b,N]=o.useState([]),[F,I]=o.useState(!1),[z,M]=o.useState(""),[_,T]=o.useState(!1),[n,E]=o.useState(null),[t,y]=o.useState(null),[pe,H]=o.useState(!1),[ge,K]=o.useState(!1),[S,A]=o.useState([]),[he,O]=o.useState(!1),[w,B]=o.useState([]),[ve,V]=o.useState(!1),[h,fe]=o.useState({stock:!0,mrp:!0,consumo:!0,solicitudes:!0,equivalencias:!0}),v=s=>{fe(l=>({...l,[s]:!l[s]}))};o.useEffect(()=>{if(!(g.trim()!==""||D.trim()!==""||P.trim()!=="")){_&&(N([]),T(!1));return}I(!0),M(""),T(!0);const l=[D.trim(),P.trim()].filter(Boolean).join(" ");q.buscar({codigo:g.trim(),descripcion:l,limit:Le}).then(d=>{N(d.data||[])}).catch(d=>{var c,le,ie;console.error("search materiales",d),M(((ie=(le=(c=d.response)==null?void 0:c.data)==null?void 0:le.error)==null?void 0:ie.message)||d.message),N([])}).finally(()=>I(!1))},[g,D,P,_]);const X=o.useCallback(async s=>{var l,d;E(s),K(!0),H(!0),y(null),A([]),B([]);try{const c=await q.detalle(s.codigo);y(c.data||{})}catch(c){console.error("detalle material",c),y(null)}finally{H(!1)}O(!0);try{const c=await q.solicitudes(s.codigo);A(((l=c.data)==null?void 0:l.solicitudes)||[])}catch(c){console.error("solicitudes material",c),A([])}finally{O(!1)}V(!0);try{const c=await De.porMaterial(s.codigo);B(((d=c.data)==null?void 0:d.equivalencias)||[])}catch(c){console.error("equivalencias material",c),B([])}finally{V(!1)}},[]),je=o.useCallback(()=>{m(""),u(""),j(""),N([]),T(!1),E(null)},[]),be=o.useCallback(()=>{K(!1),E(null),y(null)},[]);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ae,{title:a("catalogo_materiales_titulo","Catálogo de Materiales"),subtitle:a("catalogo_materiales_subtitulo","Busca materiales por código SAP, descripción o palabra clave")}),e.jsx(me,{hover:!1,children:e.jsx(xe,{className:"pt-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"lg:w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wide mb-2",children:a("catalogo_codigo_sap","Código SAP")}),e.jsx(R,{value:r,onChange:s=>m(s.target.value),placeholder:"Ej: 100012345",className:"font-mono"})]}),e.jsxs("div",{className:"flex-1 lg:max-w-md",children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wide mb-2",children:a("catalogo_descripcion","Descripción")}),e.jsx(R,{value:x,onChange:s=>u(s.target.value),placeholder:a("catalogo_buscar_desc","Buscar por descripción...")})]}),e.jsxs("div",{className:"flex-1 lg:max-w-sm",children:[e.jsx("label",{className:"block text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wide mb-2",children:a("catalogo_palabra_clave","Palabra clave")}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{value:p,onChange:s=>j(s.target.value),placeholder:a("catalogo_buscar_keyword","Filtro adicional...")}),(r||x||p)&&e.jsx("button",{type:"button",onClick:je,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1 hover:bg-[var(--bg-elevated)] rounded transition-colors",children:e.jsx(_e,{className:"h-4 w-4 text-[var(--fg-muted)]"})})]})]}),e.jsx("div",{className:"flex items-end",children:F?e.jsxs("div",{className:"flex items-center gap-2 h-10 px-4 text-[var(--fg-muted)]",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:a("common_buscando","Buscando...")})]}):_&&e.jsx("div",{className:"flex items-center h-10 px-4",children:e.jsxs(k,{variant:b.length>0?"primary":"ghost",children:[b.length," ",a("common_resultados","resultados")]})})})]})})}),z&&e.jsx(Ee,{variant:"danger",onDismiss:()=>M(""),children:z}),e.jsxs(me,{hover:!1,children:[e.jsx(Me,{children:e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5 text-[var(--primary)]"}),a("catalogo_resultados","Resultados de Búsqueda")]})}),e.jsx(xe,{children:F?e.jsx(qe,{rows:5,columns:5}):_?b.length===0?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ne,{className:"h-12 w-12 text-[var(--fg-muted)]/30 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--fg-muted)]",children:a("catalogo_sin_resultados","No se encontraron materiales con los criterios de búsqueda")})]}):e.jsx("div",{className:"overflow-x-auto border border-[var(--border)] rounded-lg",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] bg-[var(--bg-soft)]",children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider text-[var(--fg-muted)]",children:a("catalogo_col_codigo","Código")}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase tracking-wider text-[var(--fg-muted)]",children:a("catalogo_col_descripcion","Descripción")}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wider text-[var(--fg-muted)]",children:a("catalogo_col_unidad","Unidad")}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-bold uppercase tracking-wider text-[var(--fg-muted)]",children:a("catalogo_col_precio","Precio USD")}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold uppercase tracking-wider text-[var(--fg-muted)]",children:a("catalogo_col_acciones","Acciones")})]})}),e.jsx("tbody",{children:b.map((s,l)=>e.jsxs("tr",{className:`
                        border-b border-[var(--border)] transition-colors cursor-pointer
                        ${l%2===0?"bg-transparent":"bg-[var(--bg-soft)]/30"}
                        hover:bg-[var(--bg-elevated)]
                        ${(n==null?void 0:n.codigo)===s.codigo?"ring-2 ring-inset ring-[var(--primary)]":""}
                      `,onClick:()=>X(s),children:[e.jsx("td",{className:"px-4 py-3 font-mono font-semibold text-[var(--primary)]",children:s.codigo}),e.jsxs("td",{className:"px-4 py-3 text-[var(--fg)]",children:[e.jsx("p",{className:"line-clamp-1",children:s.descripcion}),s.descripcion_larga&&s.descripcion_larga!==s.descripcion&&e.jsx("p",{className:"text-xs text-[var(--fg-muted)] line-clamp-1 mt-0.5",children:s.descripcion_larga})]}),e.jsx("td",{className:"px-4 py-3 text-center text-[var(--fg-muted)]",children:s.unidad||"-"}),e.jsx("td",{className:"px-4 py-3 text-right font-mono text-[var(--fg)]",children:L(s.precio_usd||0)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs(Se,{size:"sm",variant:"ghost",onClick:d=>{d.stopPropagation(),X(s)},children:[e.jsx(ue,{className:"h-4 w-4"}),a("catalogo_ver_detalle","Ver detalle")]})})]},s.codigo))})]})}):e.jsxs("div",{className:"py-12 text-center",children:[e.jsx(ye,{className:"h-12 w-12 text-[var(--fg-muted)]/30 mx-auto mb-4"}),e.jsx("p",{className:"text-[var(--fg-muted)]",children:a("catalogo_instruccion","Ingresa un código SAP, descripción o palabra clave para buscar materiales")})]})})]}),e.jsx(Be,{isOpen:ge,onClose:be,title:n?`${n.codigo} — ${n.descripcion}`:a("catalogo_detalle_titulo","Detalle del Material"),size:"xl",children:pe?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-[var(--primary)]"})}):n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-[var(--bg-soft)] border border-[var(--border)] rounded-lg",children:[e.jsx("p",{className:"text-xs uppercase font-semibold text-[var(--fg-muted)] mb-2",children:a("catalogo_desc_larga","Descripción larga")}),e.jsx("p",{className:"text-[var(--fg)]",children:n.descripcion_larga||n.descripcion||"N/D"})]}),e.jsxs("div",{className:"p-4 bg-[var(--bg-soft)] border border-[var(--border)] rounded-lg space-y-2",children:[e.jsx(i,{label:a("catalogo_unidad","Unidad"),value:n.unidad||"N/D"}),e.jsx(i,{label:a("catalogo_precio_usd","Precio USD"),value:L(n.precio_usd||0)})]})]}),e.jsx(f,{title:a("catalogo_stock","Stock"),icon:e.jsx(we,{className:"h-4 w-4"}),expanded:h.stock,onToggle:()=>v("stock"),variant:"info",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{label:a("catalogo_stock_total","Stock Total"),value:(t==null?void 0:t.stock_total)??"N/D"}),e.jsx(i,{label:a("catalogo_pedidos_curso","Pedidos en Curso"),value:(t==null?void 0:t.pedidos_en_curso)??"N/D"}),((G=t==null?void 0:t.stock_detalle)==null?void 0:G.length)>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs uppercase font-semibold text-[var(--fg-muted)] mb-2",children:a("catalogo_stock_por_centro","Desglose por Centro/Almacén")}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:t.stock_detalle.map((s,l)=>e.jsxs("div",{className:"text-xs p-2 bg-[var(--bg)] rounded border border-[var(--border)]",children:[e.jsxs("span",{className:"font-medium",children:["Centro ",s.centro]})," /",e.jsxs("span",{className:"ml-1",children:["Almacén ",Pe(s.almacen_consultado||s.almacen)]}),s.lote&&e.jsxs("span",{className:"ml-1",children:["/ Lote ",s.lote]}),e.jsxs("span",{className:"ml-2 font-mono font-semibold text-[var(--primary)]",children:["Stock: ",s.stock]})]},l))})]})]})}),e.jsx(f,{title:a("catalogo_mrp","Parámetros MRP"),icon:e.jsx(de,{className:"h-4 w-4"}),expanded:h.mrp,onToggle:()=>v("mrp"),variant:"warning",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{label:a("catalogo_planificado_mrp","Planificado MRP"),value:(J=t==null?void 0:t.mrp)!=null&&J.planificado_mrp?"Sí":"No"}),e.jsx(i,{label:a("catalogo_sector","Sector"),value:((Q=t==null?void 0:t.mrp)==null?void 0:Q.sector)||"N/D"}),e.jsx(i,{label:a("catalogo_stock_seguridad","Stock Seguridad"),value:((W=t==null?void 0:t.mrp)==null?void 0:W.stock_seguridad)??"N/D"}),e.jsx(i,{label:a("catalogo_punto_pedido","Punto de Pedido"),value:((Y=t==null?void 0:t.mrp)==null?void 0:Y.punto_pedido)??"N/D"}),e.jsx(i,{label:a("catalogo_stock_maximo","Stock Máximo"),value:((Z=t==null?void 0:t.mrp)==null?void 0:Z.stock_maximo)??"N/D"})]})}),e.jsx(f,{title:a("catalogo_consumo","Consumo Histórico"),icon:e.jsx(de,{className:"h-4 w-4"}),expanded:h.consumo,onToggle:()=>v("consumo"),variant:"success",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{label:a("catalogo_total_consumo","Total Consumido"),value:(ae=(ee=t==null?void 0:t.consumo)==null?void 0:ee.total)!=null&&ae.toFixed?t.consumo.total.toFixed(0):"N/D"}),e.jsx(i,{label:a("catalogo_promedio_anual","Promedio Anual"),value:(te=(se=t==null?void 0:t.consumo)==null?void 0:se.promedio_anual)!=null&&te.toFixed?t.consumo.promedio_anual.toFixed(0):"N/D"}),e.jsx(i,{label:a("catalogo_rango_anios","Rango de Años"),value:(oe=t==null?void 0:t.consumo)!=null&&oe.anio_desde?`${t.consumo.anio_desde} - ${t.consumo.anio_hasta}`:"N/D"}),((ce=(re=t==null?void 0:t.consumo)==null?void 0:re.registros)==null?void 0:ce.length)>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs uppercase font-semibold text-[var(--fg-muted)] mb-2",children:a("catalogo_ultimos_consumos","Últimos Consumos")}),e.jsx("div",{className:"space-y-1",children:t.consumo.registros.map((s,l)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:s.fecha}),e.jsx("span",{className:"font-mono font-semibold",children:s.cantidad})]},l))})]})]})}),e.jsx(f,{title:a("catalogo_solicitudes_spm","Solicitudes SPM Activas"),icon:e.jsx(Ce,{className:"h-4 w-4"}),expanded:h.solicitudes,onToggle:()=>v("solicitudes"),variant:"primary",badge:S.length>0?S.length:void 0,children:he?e.jsxs("div",{className:"flex items-center gap-2 text-[var(--fg-muted)]",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:a("common_cargando","Cargando...")})]}):S.length===0?e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:a("catalogo_sin_solicitudes","No hay solicitudes SPM activas para este material")}):e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"p-3 bg-[var(--bg)] border border-[var(--border)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-semibold text-[var(--primary)]",children:["SPM #",s.id]}),e.jsx(k,{variant:$e(s.estado),children:s.estado})]}),e.jsxs("div",{className:"text-xs text-[var(--fg-muted)] space-y-0.5",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Solicitante:"})," ",s.solicitante]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cantidad:"})," ",s.cantidad_solicitada]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(s.fecha).toLocaleDateString()]}),s.centro&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Centro:"})," ",s.centro]})]})]},s.id))})}),e.jsx(f,{title:a("catalogo_equivalencias","Materiales Equivalentes"),icon:e.jsx(ke,{className:"h-4 w-4"}),expanded:h.equivalencias,onToggle:()=>v("equivalencias"),variant:"accent",badge:w.length>0?w.length:void 0,children:ve?e.jsxs("div",{className:"flex items-center gap-2 text-[var(--fg-muted)]",children:[e.jsx(C,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:a("common_cargando","Cargando...")})]}):w.length===0?e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:a("catalogo_sin_equivalencias","No hay materiales equivalentes registrados")}):e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs("div",{className:"p-3 bg-[var(--bg)] border border-[var(--border)] rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"font-mono font-semibold text-[var(--accent)]",children:s.codigo_equivalente}),e.jsx(Re,{percent:s.compatibilidad_pct})]}),e.jsx("p",{className:"text-sm text-[var(--fg)]",children:s.descripcion_equivalente}),s.descripcion&&e.jsx("p",{className:"text-xs text-[var(--fg-muted)] mt-1",children:s.descripcion}),s.precio_usd&&e.jsx("p",{className:"text-xs font-mono text-[var(--fg-muted)] mt-1",children:L(s.precio_usd)})]},s.id||s.codigo_equivalente))})})]})})]})}function i({label:a,value:r}){return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-[var(--fg-muted)]",children:a}),e.jsx("span",{className:"font-semibold text-[var(--fg-strong)]",children:r})]})}function f({title:a,icon:r,expanded:m,onToggle:x,variant:u="default",badge:p,children:j}){const g={default:"border-[var(--border)]",primary:"border-[var(--primary)]/30 bg-[var(--primary)]/5",info:"border-[var(--info)]/30 bg-[var(--info)]/5",warning:"border-[var(--warning)]/30 bg-[var(--warning)]/5",success:"border-[var(--success)]/30 bg-[var(--success)]/5",accent:"border-[var(--accent)]/30 bg-[var(--accent)]/5"};return e.jsxs("div",{className:`border rounded-lg overflow-hidden ${g[u]}`,children:[e.jsxs("button",{type:"button",onClick:x,className:"w-full px-4 py-3 flex items-center justify-between hover:bg-[var(--bg-elevated)] transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r,e.jsx("span",{className:"font-medium text-[var(--fg-strong)]",children:a}),p!==void 0&&e.jsx(k,{variant:"primary",size:"sm",children:p})]}),e.jsx(ue,{className:`h-4 w-4 text-[var(--fg-muted)] transition-transform ${m?"rotate-90":""}`})]}),m&&e.jsx("div",{className:"px-4 pb-4 pt-2 border-t border-[var(--border)]",children:j})]})}function Re({percent:a}){let r="success";return a<50?r="danger":a<80&&(r="warning"),e.jsxs(k,{variant:r,children:[a,"% compatible"]})}function $e(a){return{submitted:"warning",approved:"success",processing:"info",dispatched:"primary",rejected:"danger",closed:"ghost",draft:"ghost"}[a]||"ghost"}export{ea as default};
