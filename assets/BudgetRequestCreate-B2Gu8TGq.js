import{u as T,b as q,r as o,j as e,B as j,Q as J,M as K,x as O,d as E}from"./index-C0KzVn15.js";import{b as L}from"./spm-DzdMHgGJ.js";import{C as h,a as _,b as N,d as V,c as y}from"./Card-CZhI6Cu1.js";import{P as z}from"./PageHeader-CTTYnUT3.js";import{A as P}from"./Alert-JliWwR_S.js";import{f as S}from"./formatters-B3FH-qkk.js";import{A as Q}from"./arrow-left-dAZJ5Etu.js";import{D as G}from"./dollar-sign-B0Ok6wWx.js";import"./info-A2zy8862.js";import"./alert-circle-mNlb3XAQ.js";import"./x-circle-BDEZXh-7.js";import"./check-circle-BLjEl7wu.js";const W=2e5,X=1e6;function de(){const m=T(),{t:s}=q(),[C,n]=o.useState(""),[w,p]=o.useState(""),[f,M]=o.useState(!1),[b,A]=o.useState(!1),[t,D]=o.useState({centro:"",sector:"",monto_solicitado:"",justificacion:""}),[I,U]=o.useState([]),[R,B]=o.useState([]),[d,v]=o.useState(null);o.useEffect(()=>{(async()=>{var r,i,l;M(!0);try{const[c,x]=await Promise.all([E.get("/catalogos/centros"),E.get("/catalogos/sectores")]);U(c.data||[]),B(x.data||[])}catch(c){n(((l=(i=(r=c.response)==null?void 0:r.data)==null?void 0:i.error)==null?void 0:l.message)||c.message)}finally{M(!1)}})()},[]),o.useEffect(()=>{(async()=>{if(!t.centro||!t.sector){v(null);return}try{const r=await L.getInfo(t.centro,t.sector);v(r.data.presupuesto||null)}catch{v(null)}})()},[t.centro,t.sector]);const u=o.useCallback(a=>{const{name:r,value:i}=a.target;D(l=>({...l,[r]:i}))},[]),F=o.useCallback(a=>{const r=parseFloat(a)||0;return r>X?{nivel:"ADMIN",label:s("bur_nivel_admin","Admin (mas de $1M)")}:r>W?{nivel:"L2",label:s("bur_nivel_l2","Nivel 2 (hasta $1M)")}:{nivel:"L1",label:s("bur_nivel_l1","Nivel 1 (hasta $200K)")}},[s]),$=o.useCallback(async a=>{var i,l,c;if(a.preventDefault(),n(""),p(""),!t.centro||!t.sector){n(s("admin_required_fields","Faltan campos obligatorios"));return}const r=parseFloat(t.monto_solicitado);if(!r||r<=0){n(s("bur_create_error","Monto debe ser mayor a 0"));return}if((t.justificacion||"").trim().length<10){n(s("bur_campo_justificacion","Justificacion debe tener al menos 10 caracteres"));return}A(!0);try{await L.crear({centro:t.centro,sector:t.sector,monto_solicitado:r,justificacion:t.justificacion.trim()}),p(s("bur_create_success","Solicitud creada exitosamente")),setTimeout(()=>m("/presupuestos"),1500)}catch(x){n(((c=(l=(i=x.response)==null?void 0:i.data)==null?void 0:l.error)==null?void 0:c.message)||x.message)}finally{A(!1)}},[t,m,s]),k=F(t.monto_solicitado),g=parseFloat(t.monto_solicitado)||0,H=d?(d.saldo_usd||0)+g:null;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{title:s("bur_create_title","NUEVA SOLICITUD DE PRESUPUESTO").toUpperCase(),actions:e.jsxs(j,{variant:"ghost",onClick:()=>m("/presupuestos"),children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),s("common_volver","Volver")]})}),C&&e.jsx(P,{variant:"danger",onDismiss:()=>n(""),children:C}),w&&e.jsx(P,{variant:"success",onDismiss:()=>p(""),children:w}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(h,{children:[e.jsxs(_,{children:[e.jsx(N,{children:s("bur_create_title","Nueva Solicitud de Presupuesto")}),e.jsx(V,{children:s("bur_create_subtitle","Solicita un aumento de presupuesto para un centro/sector")})]}),e.jsx(y,{children:e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[e.jsx(J,{className:"w-4 h-4 inline mr-2"}),s("bur_campo_centro","Centro")," *"]}),e.jsxs("select",{name:"centro",value:t.centro,onChange:u,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",disabled:f,children:[e.jsxs("option",{value:"",children:[s("crud_select","Selecciona"),"..."]}),I.map(a=>e.jsxs("option",{value:a.codigo||a.id,children:[a.codigo||a.id," - ",a.nombre||a.descripcion||""]},a.codigo||a.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[e.jsx(K,{className:"w-4 h-4 inline mr-2"}),s("bur_campo_sector","Sector")," *"]}),e.jsxs("select",{name:"sector",value:t.sector,onChange:u,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",disabled:f,children:[e.jsxs("option",{value:"",children:[s("crud_select","Selecciona"),"..."]}),R.map(a=>e.jsx("option",{value:a.nombre,children:a.nombre||a.descripcion||""},a.id||a.codigo))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[e.jsx(G,{className:"w-4 h-4 inline mr-2"}),s("bur_campo_monto","Monto (USD)")," *"]}),e.jsx("input",{type:"number",name:"monto_solicitado",value:t.monto_solicitado,onChange:u,min:"1",step:"0.01",placeholder:"0.00",className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all font-mono"}),g>0&&e.jsxs("p",{className:"text-xs text-[var(--fg-muted)]",children:[s("bur_col_nivel","Nivel de aprobacion"),": ",e.jsx("span",{className:"font-semibold text-[var(--primary)]",children:k.label})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[s("bur_campo_justificacion","Justificacion")," *"]}),e.jsx("textarea",{name:"justificacion",value:t.justificacion,onChange:u,rows:4,placeholder:s("bur_campo_justificacion_placeholder","Explica el motivo del aumento de presupuesto..."),className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all resize-none"}),e.jsxs("p",{className:"text-xs text-[var(--fg-muted)]",children:[(t.justificacion||"").length,"/10 ",s("common_minimo","minimo")]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-[var(--border)]",children:[e.jsx(j,{type:"button",variant:"ghost",onClick:()=>m("/presupuestos"),disabled:b,children:s("bur_btn_cancelar","Cancelar")}),e.jsxs(j,{type:"submit",disabled:b||f,className:"flex-1",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),b?s("common_cargando","Cargando..."):s("bur_btn_enviar","Enviar Solicitud")]})]})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[d&&e.jsxs(h,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(N,{className:"text-base",children:s("bur_saldo_actual","Saldo actual")})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("common_presupuesto","Presupuesto")}),e.jsx("span",{className:"font-mono text-lg font-semibold text-[var(--fg)]",children:S(d.monto_usd)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_saldo_actual","Saldo")}),e.jsx("span",{className:"font-mono text-lg font-semibold text-[var(--success)]",children:S(d.saldo_usd)})]}),g>0&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"border-t border-[var(--border)] pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_saldo_nuevo","Nuevo saldo")}),e.jsx("span",{className:"font-mono text-lg font-semibold text-[var(--primary)]",children:S(H)})]})})})]})})]}),e.jsxs(h,{children:[e.jsx(_,{className:"pb-2",children:e.jsx(N,{className:"text-base",children:s("bur_col_nivel","Niveles de Aprobacion")})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[var(--fg-muted)]",children:"L1"}),e.jsx("span",{children:s("bur_nivel_l1","Hasta $200K")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[var(--fg-muted)]",children:"L2"}),e.jsx("span",{children:s("bur_nivel_l2","Hasta $1M")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-[var(--fg-muted)]",children:"Admin"}),e.jsx("span",{children:s("bur_nivel_admin","Mas de $1M")})]})]})})]})]})]})]})}export{de as default};
