import{b as W,r as l,d as g,j as e,B as n,q,U as _,e as $,h as P,z as Y,x as Z}from"./index-DSailSuQ.js";import{C as V,a as ee,b as ae,d as se,c as re}from"./Card-DuU2GO_U.js";import{P as te}from"./PageHeader-YH3gAQyl.js";import{A as F}from"./Alert-DnMC6g2-.js";import{M as N}from"./Modal-B5O43XTM.js";import{S as ie}from"./StatusBadge-_WxXNdKR.js";import{C as w}from"./check-circle-BdkCzlrZ.js";import{X as k}from"./x-circle-CUJIA21-.js";import{A as le}from"./arrow-right-DixEshMu.js";import"./info-D6z4HOD_.js";import"./alert-circle-7AkYIq0l.js";import"./styleConfig-BS4Td6el.js";import"./archive-xFhOk_-M.js";const oe={pendiente:"Pendiente",aprobado:"Aprobada",rechazado:"Rechazada"},L={sector_nuevo:"Sector",centros_nuevos:"Centros",almacenes_nuevos:"Almacenes",jefe_nuevo:"Jefe",gerente1_nuevo:"Gerente 1",gerente2_nuevo:"Gerente 2"};function B(s){if(!s)return"-";try{return new Date(s).toLocaleDateString("es-AR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return s}}function _e(){var M,E,R,D,O,T;const{t:s}=W(),[y,U]=l.useState([]),[C,z]=l.useState(!1),[S,c]=l.useState(""),[A,d]=l.useState(""),[b,G]=l.useState("pendiente"),[o,j]=l.useState({open:!1,request:null,detail:null}),[x,h]=l.useState({open:!1,id:null,comentario:""}),[m,f]=l.useState({open:!1,id:null,motivo:""}),[p,v]=l.useState({open:!1,id:null,mensaje:""}),u=l.useCallback(async()=>{var a,r,t;z(!0),c("");try{const i=b!=="todas"?{estado:b}:{},Q=await g.get("/mi-cuenta/admin/profile-requests",{params:i});U(Q.data.requests||[])}catch(i){c(((t=(r=(a=i.response)==null?void 0:a.data)==null?void 0:r.error)==null?void 0:t.message)||i.message)}finally{z(!1)}},[b]);l.useEffect(()=>{u()},[u]);const I=l.useCallback(async a=>{j({open:!0,request:a,detail:null});try{const r=await g.get(`/mi-cuenta/admin/profile-requests/${a.id}`);j(t=>({...t,detail:r.data.request}))}catch(r){console.error("Error loading detail:",r)}},[]),H=l.useCallback(async()=>{var a,r,t;if(x.id){c("");try{await g.post(`/mi-cuenta/admin/profile-requests/${x.id}/aprobar`,{comentario:x.comentario}),d(s("profile_req_aprobada","Solicitud aprobada y cambios aplicados")),h({open:!1,id:null,comentario:""}),j({open:!1,request:null,detail:null}),u(),setTimeout(()=>d(""),3e3)}catch(i){c(((t=(r=(a=i.response)==null?void 0:a.data)==null?void 0:r.error)==null?void 0:t.message)||i.message)}}},[x,u,s]),X=l.useCallback(async()=>{var a,r,t;if(!m.id||!m.motivo.trim()){c(s("profile_req_motivo_required","Debe indicar un motivo"));return}c("");try{await g.post(`/mi-cuenta/admin/profile-requests/${m.id}/rechazar`,{motivo:m.motivo}),d(s("profile_req_rechazada","Solicitud rechazada")),f({open:!1,id:null,motivo:""}),j({open:!1,request:null,detail:null}),u(),setTimeout(()=>d(""),3e3)}catch(i){c(((t=(r=(a=i.response)==null?void 0:a.data)==null?void 0:r.error)==null?void 0:t.message)||i.message)}},[m,u,s]),J=l.useCallback(async()=>{var a,r,t;if(!p.id||!p.mensaje.trim()){c(s("profile_req_mensaje_required","Debe escribir un mensaje"));return}c("");try{await g.post(`/mi-cuenta/admin/profile-requests/${p.id}/mensaje`,{mensaje:p.mensaje}),d(s("profile_req_mensaje_enviado","Mensaje enviado al solicitante")),v({open:!1,id:null,mensaje:""}),setTimeout(()=>d(""),3e3)}catch(i){c(((t=(r=(a=i.response)==null?void 0:a.data)==null?void 0:r.error)==null?void 0:t.message)||i.message)}},[p,s]),K=[{key:"pendiente",label:s("profile_req_tab_pendientes","Pendientes")},{key:"aprobado",label:s("profile_req_tab_aprobadas","Aprobadas")},{key:"rechazado",label:s("profile_req_tab_rechazadas","Rechazadas")},{key:"todas",label:s("profile_req_tab_todas","Todas")}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(te,{title:s("profile_req_title","SOLICITUDES DE CAMBIO DE PERFIL").toUpperCase(),actions:e.jsxs(n,{variant:"ghost",onClick:u,disabled:C,children:[e.jsx(q,{className:`w-4 h-4 mr-2 ${C?"animate-spin":""}`}),s("common_refresh","Actualizar")]})}),S&&e.jsx(F,{variant:"danger",onDismiss:()=>c(""),children:S}),A&&e.jsx(F,{variant:"success",onDismiss:()=>d(""),children:A}),e.jsxs(V,{children:[e.jsxs(ee,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5 text-[var(--primary)]"}),s("profile_req_subtitle","Gestionar solicitudes de actualizacion de perfil")]}),e.jsx(se,{children:s("profile_req_desc","Aprueba, rechaza o solicita mas informacion sobre los cambios de perfil")})]}),e.jsxs(re,{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-1 p-1 bg-[var(--surface)] rounded-lg w-fit",children:K.map(a=>e.jsx("button",{onClick:()=>G(a.key),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${b===a.key?"bg-[var(--primary)] text-white":"text-[var(--fg-muted)] hover:text-[var(--fg)] hover:bg-[var(--card)]"}`,children:a.label},a.key))}),C?e.jsxs("div",{className:"text-center py-12 text-[var(--fg-muted)]",children:[e.jsx(q,{className:"w-8 h-8 mx-auto mb-3 animate-spin"}),e.jsx("p",{children:s("common_cargando","Cargando...")})]}):y.length===0?e.jsxs("div",{className:"text-center py-12 text-[var(--fg-muted)]",children:[e.jsx(_,{className:"w-12 h-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{className:"text-lg font-medium",children:s("profile_req_empty","No hay solicitudes")})]}):e.jsx("div",{className:"divide-y divide-[var(--border)]",children:y.map(a=>{var r;return e.jsxs("div",{className:"flex items-center gap-4 p-4 hover:bg-[var(--surface)] cursor-pointer transition-colors",onClick:()=>I(a),children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-[var(--primary)]/10 flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-[var(--primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-[var(--fg)]",children:((r=a.solicitante)==null?void 0:r.nombre)||a.usuario_id}),e.jsx(ie,{estado:oe[a.estado]||a.estado})]}),e.jsxs("div",{className:"text-sm text-[var(--fg-muted)] mt-1",children:["Solicita cambiar: ",Object.keys(a.cambios_solicitados||{}).map(t=>L[t]||t).join(", ")]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-[var(--fg-subtle)] mt-1",children:[e.jsx($,{className:"w-3 h-3"}),B(a.created_at)]})]}),e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2",onClick:t=>t.stopPropagation(),children:[a.estado==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx(n,{size:"sm",onClick:()=>h({open:!0,id:a.id,comentario:""}),title:s("profile_req_aprobar","Aprobar"),children:e.jsx(w,{className:"w-4 h-4"})}),e.jsx(n,{size:"sm",variant:"danger",onClick:()=>f({open:!0,id:a.id,motivo:""}),title:s("profile_req_rechazar","Rechazar"),children:e.jsx(k,{className:"w-4 h-4"})}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>v({open:!0,id:a.id,mensaje:""}),title:s("profile_req_mensaje","Enviar mensaje"),children:e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx(Y,{className:"w-5 h-5 text-[var(--fg-subtle)]"})]})]},a.id)})})]})]}),e.jsx(N,{isOpen:o.open,onClose:()=>j({open:!1,request:null,detail:null}),title:`Solicitud #${(M=o.request)==null?void 0:M.id}`,size:"lg",footer:((E=o.request)==null?void 0:E.estado)==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"ghost",onClick:()=>{var a;return v({open:!0,id:(a=o.request)==null?void 0:a.id,mensaje:""})},children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),s("profile_req_mensaje","Mensaje")]}),e.jsxs(n,{variant:"danger",onClick:()=>{var a;return f({open:!0,id:(a=o.request)==null?void 0:a.id,motivo:""})},children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),s("profile_req_rechazar","Rechazar")]}),e.jsxs(n,{onClick:()=>{var a;return h({open:!0,id:(a=o.request)==null?void 0:a.id,comentario:""})},children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),s("profile_req_aprobar","Aprobar")]})]}),children:o.detail?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-[var(--surface)]",children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--fg-muted)] mb-2",children:"Solicitante"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-[var(--primary)]/10 flex items-center justify-center",children:e.jsx(_,{className:"w-6 h-6 text-[var(--primary)]"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-[var(--fg)]",children:(R=o.detail.solicitante)==null?void 0:R.nombre}),e.jsx("div",{className:"text-sm text-[var(--fg-muted)]",children:(D=o.detail.solicitante)==null?void 0:D.mail}),e.jsxs("div",{className:"text-xs text-[var(--fg-subtle)]",children:[(O=o.detail.solicitante)==null?void 0:O.posicion," - ",(T=o.detail.solicitante)==null?void 0:T.sector]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-[var(--fg-muted)] mb-3",children:"Cambios Solicitados"}),e.jsx("div",{className:"space-y-3",children:Object.entries(o.detail.requested_values||{}).map(([a,r])=>{var i;const t=(i=o.detail.current_values)==null?void 0:i[a];return e.jsxs("div",{className:"p-3 rounded-lg border border-[var(--border)] bg-[var(--card)]",children:[e.jsx("div",{className:"text-xs font-semibold text-[var(--fg-muted)] uppercase mb-2",children:L[`${a}_nuevo`]||a}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1 p-2 rounded bg-[var(--surface)] text-sm",children:[e.jsx("span",{className:"text-[var(--fg-subtle)]",children:"Actual: "}),e.jsx("span",{className:"text-[var(--fg)]",children:Array.isArray(t)?t.join(", "):t||"-"})]}),e.jsx(le,{className:"w-5 h-5 text-[var(--primary)]"}),e.jsxs("div",{className:"flex-1 p-2 rounded bg-[var(--primary)]/10 text-sm",children:[e.jsx("span",{className:"text-[var(--fg-subtle)]",children:"Nuevo: "}),e.jsx("span",{className:"font-semibold text-[var(--primary)]",children:Array.isArray(r)?r.join(", "):r||"-"})]})]})]},a)})})]}),e.jsxs("div",{className:"text-xs text-[var(--fg-subtle)] flex items-center gap-2",children:[e.jsx($,{className:"w-3 h-3"}),"Solicitado el ",B(o.detail.created_at)]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx(q,{className:"w-6 h-6 mx-auto animate-spin text-[var(--fg-muted)]"})})}),e.jsx(N,{isOpen:x.open,onClose:()=>h({open:!1,id:null,comentario:""}),title:s("profile_req_aprobar_title","Aprobar Solicitud"),size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"ghost",onClick:()=>h({open:!1,id:null,comentario:""}),children:s("common_cancelar","Cancelar")}),e.jsxs(n,{onClick:H,children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),s("profile_req_aprobar","Aprobar")]})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:s("profile_req_aprobar_desc","Los cambios se aplicaran automaticamente al perfil del usuario.")}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-[var(--fg)]",children:s("profile_req_comentario","Comentario (opcional)")}),e.jsx("textarea",{value:x.comentario,onChange:a=>h(r=>({...r,comentario:a.target.value})),rows:3,className:"w-full mt-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:"Mensaje opcional para el solicitante..."})]})]})}),e.jsx(N,{isOpen:m.open,onClose:()=>f({open:!1,id:null,motivo:""}),title:s("profile_req_rechazar_title","Rechazar Solicitud"),size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"ghost",onClick:()=>f({open:!1,id:null,motivo:""}),children:s("common_cancelar","Cancelar")}),e.jsxs(n,{variant:"danger",onClick:X,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),s("profile_req_rechazar","Rechazar")]})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:s("profile_req_rechazar_desc","El solicitante sera notificado del rechazo.")}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[s("profile_req_motivo","Motivo del rechazo")," *"]}),e.jsx("textarea",{value:m.motivo,onChange:a=>f(r=>({...r,motivo:a.target.value})),rows:3,className:"w-full mt-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:"Indica el motivo del rechazo..."})]})]})}),e.jsx(N,{isOpen:p.open,onClose:()=>v({open:!1,id:null,mensaje:""}),title:s("profile_req_mensaje_title","Enviar Mensaje"),size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"ghost",onClick:()=>v({open:!1,id:null,mensaje:""}),children:s("common_cancelar","Cancelar")}),e.jsxs(n,{onClick:J,children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),s("profile_req_enviar","Enviar")]})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:s("profile_req_mensaje_desc","El mensaje sera enviado a la bandeja de entrada del solicitante.")}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-[var(--fg)]",children:[s("profile_req_mensaje_contenido","Mensaje")," *"]}),e.jsx("textarea",{value:p.mensaje,onChange:a=>v(r=>({...r,mensaje:a.target.value})),rows:4,className:"w-full mt-2 px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:"Escribe tu mensaje..."})]})]})})]})}export{_e as default};
