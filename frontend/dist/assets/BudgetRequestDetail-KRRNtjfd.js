import{o as H,u as V,a as X,b as G,r as c,j as e,B as m,G as J,M as K,I as Q,U as W,F as Y}from"./index-Sv0ImAih.js";import{b as N}from"./spm-CEYuI1MD.js";import{C as _,a as y,b as C,c as w,d as Z}from"./Card-Dxkx64Zs.js";import{P as R}from"./PageHeader-eKYThyjS.js";import{A as z}from"./Alert-CqYdOks6.js";import{S as ee}from"./StatusBadge-WR3bOBfa.js";import{f as j}from"./formatters-Ctz0mOCI.js";import{M as $}from"./Modal-DsPy8HQI.js";import{A as E}from"./arrow-left-DQ0j-MbS.js";import{C as S}from"./check-circle-C7xi_Sig.js";import{X as A}from"./x-circle-CAJHshED.js";import{D as se}from"./dollar-sign-ByS9KCG2.js";import{C as ae}from"./calendar-IygWvWK8.js";import"./alert-circle-B4RDZmxs.js";import"./styleConfig-C9yLMt_s.js";import"./archive-DdCsdsUn.js";const re={pendiente:"Pendiente",aprobado_l1:"Aprobado L1",aprobado_l2:"Aprobado L2",aprobado:"Aprobada",rechazado:"Rechazada"},te={L1:"Nivel 1 (hasta $200K)",L2:"Nivel 2 (hasta $1M)",ADMIN:"Admin (mas de $1M)"};function _e(){const{id:i}=H(),D=V(),{user:oe}=X(),{t:s}=G(),[a,B]=c.useState(null),[f,M]=c.useState(null),[k,n]=c.useState(""),[L,u]=c.useState(""),[P,I]=c.useState(!0),[g,p]=c.useState({open:!1,comentario:""}),[b,v]=c.useState({open:!1,motivo:""}),x=c.useCallback(async()=>{var r,t,d;I(!0),n("");try{const o=(await N.obtener(i)).data.request;if(B(o),o!=null&&o.centro&&(o!=null&&o.sector))try{const O=await N.getInfo(o.centro,o.sector);M(O.data.presupuesto||null)}catch{M(null)}}catch(l){n(((d=(t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)==null?void 0:d.message)||l.message)}finally{I(!1)}},[i]);c.useEffect(()=>{x()},[x]);const F=c.useCallback(async()=>{var r,t,d;n(""),u("");try{await N.aprobar(i,g.comentario),u(s("bur_aprobada_msg","Solicitud de presupuesto aprobada")),p({open:!1,comentario:""}),x()}catch(l){n(((d=(t=(r=l.response)==null?void 0:r.data)==null?void 0:t.error)==null?void 0:d.message)||l.message)}},[i,g.comentario,x,s]),T=c.useCallback(async()=>{var t,d,l;n(""),u("");const r=b.motivo.trim();if(r.length<5){n(s("bur_motivo_required","Debe proporcionar un motivo"));return}try{await N.rechazar(i,r),u(s("bur_rechazada_msg","Solicitud de presupuesto rechazada")),v({open:!1,motivo:""}),x()}catch(o){n(((l=(d=(t=o.response)==null?void 0:t.data)==null?void 0:d.error)==null?void 0:l.message)||o.message)}},[i,b.motivo,x,s]),h=r=>r?new Date(r).toLocaleDateString("es-AR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",U=(a==null?void 0:a.estado)==="pendiente",q=f&&a?(f.saldo_usd||0)+(a.monto_solicitado_usd||0):null;return P?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"text-[var(--fg-muted)]",children:s("common_cargando","Cargando...")})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{title:`${s("bur_detail_title","SOLICITUD")} #${i}`.toUpperCase(),actions:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"ghost",onClick:()=>D("/presupuestos"),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),s("common_volver","Volver")]}),U&&e.jsxs(e.Fragment,{children:[e.jsxs(m,{onClick:()=>p({open:!0,comentario:""}),children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),s("bur_aprobar","Aprobar")]}),e.jsxs(m,{variant:"danger",onClick:()=>v({open:!0,motivo:""}),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),s("bur_rechazar","Rechazar")]})]})]})}),k&&e.jsx(z,{variant:"danger",onDismiss:()=>n(""),children:k}),L&&e.jsx(z,{variant:"success",onDismiss:()=>u(""),children:L}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs(_,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(C,{children:s("bur_detail_title","Detalle de Solicitud")}),e.jsx(ee,{estado:re[a.estado]||a.estado})]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(J,{className:"w-4 h-4"}),s("bur_campo_centro","Centro")]}),e.jsx("div",{className:"text-lg font-semibold text-[var(--fg)]",children:a.centro||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(K,{className:"w-4 h-4"}),s("bur_campo_sector","Sector")]}),e.jsx("div",{className:"text-lg font-semibold text-[var(--fg)]",children:a.sector||"-"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(se,{className:"w-4 h-4"}),s("bur_col_monto","Monto Solicitado")]}),e.jsx("div",{className:"text-2xl font-bold font-mono text-[var(--primary)]",children:j(a.monto_solicitado_usd)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(Q,{className:"w-4 h-4"}),s("bur_col_nivel","Nivel de Aprobacion")]}),e.jsx("div",{className:"text-lg font-semibold text-[var(--fg)]",children:te[a.nivel_aprobacion_requerido]||a.nivel_aprobacion_requerido})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(W,{className:"w-4 h-4"}),s("bur_solicitante","Solicitante")]}),e.jsxs("div",{className:"text-lg font-semibold text-[var(--fg)]",children:[a.solicitante_id||"-",a.solicitante_rol&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded bg-[var(--surface)] text-[var(--fg-muted)]",children:a.solicitante_rol})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)]",children:[e.jsx(ae,{className:"w-4 h-4"}),s("bur_fecha_creacion","Fecha de creacion")]}),e.jsx("div",{className:"text-lg font-semibold text-[var(--fg)]",children:h(a.created_at)})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--fg-muted)] mb-2",children:[e.jsx(Y,{className:"w-4 h-4"}),s("bur_campo_justificacion","Justificacion")]}),e.jsx("div",{className:"p-4 rounded-lg bg-[var(--surface)] text-[var(--fg)]",children:a.justificacion||"-"})]}),a.estado==="rechazado"&&a.motivo_rechazo&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--danger)] mb-2",children:[e.jsx(A,{className:"w-4 h-4"}),s("bur_motivo_rechazo","Motivo de rechazo")]}),e.jsx("div",{className:"p-4 rounded-lg bg-red-500/10 border border-red-500/20 text-[var(--fg)]",children:a.motivo_rechazo})]}),a.aprobador_id&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-[var(--border)]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-[var(--success)] mb-2",children:[e.jsx(S,{className:"w-4 h-4"}),s("common_aprobado_por","Aprobado por")]}),e.jsxs("div",{className:"text-[var(--fg)]",children:[a.aprobador_id,a.aprobador_rol&&e.jsx("span",{className:"ml-2 text-xs px-2 py-1 rounded bg-[var(--surface)] text-[var(--fg-muted)]",children:a.aprobador_rol}),a.aprobado_at&&e.jsx("span",{className:"ml-2 text-sm text-[var(--fg-muted)]",children:h(a.aprobado_at)})]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[f&&e.jsxs(_,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(C,{className:"text-base",children:s("common_presupuesto","Presupuesto")}),e.jsxs(Z,{children:[a.centro,"/",a.sector]})]}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_saldo_actual","Saldo actual")}),e.jsx("span",{className:"font-mono text-lg font-semibold text-[var(--fg)]",children:j(f.saldo_usd)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_col_monto","Aumento")}),e.jsxs("span",{className:"font-mono text-lg font-semibold text-[var(--success)]",children:["+",j(a.monto_solicitado_usd)]})]}),e.jsx("div",{className:"border-t border-[var(--border)] pt-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_saldo_nuevo","Nuevo saldo")}),e.jsx("span",{className:"font-mono text-xl font-bold text-[var(--primary)]",children:j(q)})]})})]})})]}),e.jsxs(_,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(C,{className:"text-base",children:s("common_historial","Historial")})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--primary)]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[var(--fg)]",children:s("bur_estado_pendiente","Creada")}),e.jsx("div",{className:"text-xs text-[var(--fg-muted)]",children:h(a.created_at)})]})]}),a.aprobado_at&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--success)]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[var(--fg)]",children:s("bur_estado_aprobado","Aprobada")}),e.jsx("div",{className:"text-xs text-[var(--fg-muted)]",children:h(a.aprobado_at)})]})]}),a.estado==="rechazado"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-[var(--danger)]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[var(--fg)]",children:s("bur_estado_rechazado","Rechazada")}),e.jsx("div",{className:"text-xs text-[var(--fg-muted)]",children:h(a.updated_at)})]})]})]})})]})]})]}),e.jsx($,{isOpen:g.open,onClose:()=>p({open:!1,comentario:""}),title:`${s("bur_aprobar","Aprobar")} #${i}`,size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"ghost",onClick:()=>p({open:!1,comentario:""}),children:s("common_cancelar","Cancelar")}),e.jsxs(m,{onClick:F,children:[e.jsx(S,{className:"w-4 h-4 mr-2"}),s("bur_aprobar","Aprobar")]})]}),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-[var(--fg-muted)]",children:[s("bur_confirm_aprobar","Esta accion aumentara el presupuesto de")," ",a.centro,"/",a.sector," ",s("common_en","en")," ",j(a.monto_solicitado_usd),"."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-[var(--fg-muted)]",children:s("bur_comentario_aprobacion","Comentario (opcional)")}),e.jsx("textarea",{value:g.comentario,onChange:r=>p(t=>({...t,comentario:r.target.value})),rows:3,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all"})]})]})}),e.jsx($,{isOpen:b.open,onClose:()=>v({open:!1,motivo:""}),title:`${s("bur_rechazar","Rechazar")} #${i}`,size:"md",footer:e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"ghost",onClick:()=>v({open:!1,motivo:""}),children:s("common_cancelar","Cancelar")}),e.jsxs(m,{variant:"danger",onClick:T,children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),s("bur_rechazar","Rechazar")]})]}),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm text-[var(--fg-muted)]",children:[s("bur_motivo_rechazo","Motivo de rechazo")," *"]}),e.jsx("textarea",{value:b.motivo,onChange:r=>v(t=>({...t,motivo:r.target.value})),rows:3,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:s("bur_motivo_placeholder","Indica el motivo del rechazo...")})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{title:s("bur_detail_title","DETALLE DE SOLICITUD").toUpperCase(),actions:e.jsxs(m,{variant:"ghost",onClick:()=>D("/presupuestos"),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),s("common_volver","Volver")]})}),e.jsx(z,{variant:"danger",children:s("common_no_encontrado","Solicitud no encontrada")})]})}export{_e as default};
