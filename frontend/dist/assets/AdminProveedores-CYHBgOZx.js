import{c as $,a as L,N as O,r as t,j as e,K as R,B as w,X as k}from"./index-Sv0ImAih.js";import{C as E,a as z,b as P,d as T,c as B}from"./Card-Dxkx64Zs.js";import{P as D}from"./plus-DCQGzMQZ.js";import{C as S}from"./check-TZNe560r.js";import{T as I}from"./trash-2-BL_Xn0IG.js";const F=$("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),G=$("Warehouse",[["path",{d:"M22 8.35V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8.35A2 2 0 0 1 3.26 6.5l8-3.2a2 2 0 0 1 1.48 0l8 3.2A2 2 0 0 1 22 8.35Z",key:"gksnxg"}],["path",{d:"M6 18h12",key:"9pbo8z"}],["path",{d:"M6 14h12",key:"4cwo0f"}],["rect",{width:"12",height:"12",x:"6",y:"10",key:"apd30q"}]]),h="http://localhost:5000";function Z(){const{token:n}=L(),[p]=O(),C=p.get("tab")==="externos"?"externos":"internos",[b,f]=t.useState(C);return t.useEffect(()=>{const j=p.get("tab");(j==="externos"||j==="internos")&&f(j)},[p]),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-[var(--fg)]",children:"Proveedores"}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:"Gestiona proveedores internos (almacenes) y externos"})]})}),e.jsxs("div",{className:"flex gap-2 border-b border-[var(--border)] pb-2",children:[e.jsxs("button",{onClick:()=>f("internos"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg font-semibold text-sm transition ${b==="internos"?"bg-[var(--primary)] text-white":"text-[var(--fg-muted)] hover:text-[var(--fg)] hover:bg-[var(--bg-soft)]"}`,children:[e.jsx(G,{className:"w-4 h-4"}),"Internos (Almacenes)"]}),e.jsxs("button",{onClick:()=>f("externos"),className:`flex items-center gap-2 px-4 py-2 rounded-t-lg font-semibold text-sm transition ${b==="externos"?"bg-[var(--primary)] text-white":"text-[var(--fg-muted)] hover:text-[var(--fg)] hover:bg-[var(--bg-soft)]"}`,children:[e.jsx(R,{className:"w-4 h-4"}),"Externos"]})]}),b==="internos"?e.jsx(J,{token:n}):e.jsx(M,{token:n})]})}function J({token:n}){const[p,C]=t.useState([]),[b,f]=t.useState([]),[j,_]=t.useState(!0),[c,g]=t.useState(null),[d,x]=t.useState({}),[i,v]=t.useState(!1),[a,m]=t.useState({centro:"",almacen:"",nombre:"",libre_disponibilidad:!1,responsable_id:"",excluido:!1}),N=t.useCallback(async()=>{try{const[s,l]=await Promise.all([fetch(`${h}/api/admin/proveedores/internos`,{headers:{Authorization:`Bearer ${n}`},credentials:"include"}),fetch(`${h}/api/admin/usuarios`,{headers:{Authorization:`Bearer ${n}`},credentials:"include"})]);s.ok&&C(await s.json()),l.ok&&f(await l.json())}catch(s){console.error("Error fetching:",s)}finally{_(!1)}},[n]);t.useEffect(()=>{N()},[N]);const A=async(s,l,y)=>{(await fetch(`${h}/api/admin/proveedores/internos/${s}/${l}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},credentials:"include",body:JSON.stringify(y)})).ok&&(g(null),N())},r=async()=>{if(!a.centro||!a.almacen)return;(await fetch(`${h}/api/admin/proveedores/internos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},credentials:"include",body:JSON.stringify(a)})).ok&&(v(!1),m({centro:"",almacen:"",nombre:"",libre_disponibilidad:!1,responsable_id:"",excluido:!1}),N())},u=async(s,l)=>{confirm("Eliminar esta configuracion?")&&(await fetch(`${h}/api/admin/proveedores/internos/${s}/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`},credentials:"include"}),N())};return j?e.jsx("div",{className:"text-[var(--fg-muted)]",children:"Cargando..."}):e.jsxs(E,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Configuracion de Almacenes"}),e.jsx(T,{children:"Define politicas de disponibilidad por almacen"})]}),e.jsxs(w,{onClick:()=>v(!i),children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Agregar"]})]}),e.jsxs(B,{children:[i&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg border border-[var(--border)] bg-[var(--bg-soft)] space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsx("input",{placeholder:"Centro",value:a.centro,onChange:s=>m({...a,centro:s.target.value}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"}),e.jsx("input",{placeholder:"Almacen",value:a.almacen,onChange:s=>m({...a,almacen:s.target.value}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"}),e.jsx("input",{placeholder:"Nombre",value:a.nombre,onChange:s=>m({...a,nombre:s.target.value}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"}),e.jsxs("select",{value:a.responsable_id,onChange:s=>m({...a,responsable_id:s.target.value}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm",children:[e.jsx("option",{value:"",children:"Sin responsable"}),b.map(s=>e.jsxs("option",{value:s.id_spm,children:[s.nombre," ",s.apellido]},s.id_spm))]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-[var(--fg)]",children:[e.jsx("input",{type:"checkbox",checked:a.libre_disponibilidad,onChange:s=>m({...a,libre_disponibilidad:s.target.checked}),className:"w-4 h-4"}),"Libre disponibilidad"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-[var(--fg)]",children:[e.jsx("input",{type:"checkbox",checked:a.excluido,onChange:s=>m({...a,excluido:s.target.checked}),className:"w-4 h-4"}),"Excluido (no mostrar)"]}),e.jsx(w,{onClick:r,children:"Guardar"}),e.jsx(w,{variant:"ghost",onClick:()=>v(!1),children:"Cancelar"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-left",children:[e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Centro"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Almacen"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)] text-center",children:"Libre Disp."}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Responsable"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)] text-center",children:"Excluido"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Acciones"})]})}),e.jsx("tbody",{children:p.map(s=>{const l=`${s.centro}_${s.almacen}`,y=c===l;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--bg-hover)]",children:[e.jsx("td",{className:"px-4 py-3 text-[var(--fg)]",children:s.centro}),e.jsx("td",{className:"px-4 py-3 text-[var(--fg)] font-mono",children:s.almacen}),e.jsx("td",{className:"px-4 py-3",children:y?e.jsx("input",{value:d.nombre||"",onChange:o=>x({...d,nombre:o.target.value}),className:"px-2 py-1 rounded border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm w-full"}):e.jsx("span",{className:"text-[var(--fg)]",children:s.nombre||"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:y?e.jsx("input",{type:"checkbox",checked:d.libre_disponibilidad,onChange:o=>x({...d,libre_disponibilidad:o.target.checked}),className:"w-4 h-4"}):s.libre_disponibilidad?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[rgba(16,185,129,0.15)] text-[var(--success)] text-xs font-semibold",children:[e.jsx(S,{className:"w-3 h-3"})," Si"]}):e.jsx("span",{className:"text-[var(--fg-muted)]",children:"No"})}),e.jsx("td",{className:"px-4 py-3",children:y?e.jsxs("select",{value:d.responsable_id||"",onChange:o=>x({...d,responsable_id:o.target.value}),className:"px-2 py-1 rounded border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm",children:[e.jsx("option",{value:"",children:"Sin responsable"}),b.map(o=>e.jsxs("option",{value:o.id_spm,children:[o.nombre," ",o.apellido]},o.id_spm))]}):e.jsx("span",{className:"text-[var(--fg)]",children:s.responsable_display||"-"})}),e.jsx("td",{className:"px-4 py-3 text-center",children:y?e.jsx("input",{type:"checkbox",checked:d.excluido,onChange:o=>x({...d,excluido:o.target.checked}),className:"w-4 h-4"}):s.excluido?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[rgba(239,68,68,0.15)] text-[var(--danger)] text-xs font-semibold",children:[e.jsx(k,{className:"w-3 h-3"})," Si"]}):e.jsx("span",{className:"text-[var(--fg-muted)]",children:"No"})}),e.jsx("td",{className:"px-4 py-3",children:y?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>A(s.centro,s.almacen,d),className:"p-1.5 rounded-lg bg-[var(--success)] text-white hover:opacity-80",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g(null),className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--fg-muted)] hover:bg-[var(--bg-hover)]",children:e.jsx(k,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{g(l),x({nombre:s.nombre,libre_disponibilidad:!!s.libre_disponibilidad,responsable_id:s.responsable_id||"",excluido:!!s.excluido})},className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--fg-muted)] hover:bg-[var(--bg-hover)] hover:text-[var(--fg)]",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(s.centro,s.almacen),className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--danger)] hover:bg-[rgba(239,68,68,0.15)]",children:e.jsx(I,{className:"w-4 h-4"})})]})})]},l)})})]})})]})]})}function M({token:n}){const[p,C]=t.useState([]),[b,f]=t.useState(!0),[j,_]=t.useState(null),[c,g]=t.useState({}),[d,x]=t.useState(!1),[i,v]=t.useState({nombre:"",plazo_entrega_dias:7,rating:3}),a=t.useCallback(async()=>{try{const r=await fetch(`${h}/api/admin/proveedores/externos`,{headers:{Authorization:`Bearer ${n}`},credentials:"include"});r.ok&&C(await r.json())}catch(r){console.error("Error fetching:",r)}finally{f(!1)}},[n]);t.useEffect(()=>{a()},[a]);const m=async(r,u)=>{(await fetch(`${h}/api/admin/proveedores/externos/${r}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},credentials:"include",body:JSON.stringify(u)})).ok&&(_(null),a())},N=async()=>{if(!i.nombre)return;(await fetch(`${h}/api/admin/proveedores/externos`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},credentials:"include",body:JSON.stringify(i)})).ok&&(x(!1),v({nombre:"",plazo_entrega_dias:7,rating:3}),a())},A=async r=>{confirm("Desactivar este proveedor?")&&(await fetch(`${h}/api/admin/proveedores/externos/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`},credentials:"include"}),a())};return b?e.jsx("div",{className:"text-[var(--fg-muted)]",children:"Cargando..."}):e.jsxs(E,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{children:"Proveedores Externos"}),e.jsx(T,{children:"Gestiona proveedores de compra externa"})]}),e.jsxs(w,{onClick:()=>x(!d),children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Agregar"]})]}),e.jsxs(B,{children:[d&&e.jsxs("div",{className:"mb-4 p-4 rounded-lg border border-[var(--border)] bg-[var(--bg-soft)] space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsx("input",{placeholder:"Nombre del proveedor",value:i.nombre,onChange:r=>v({...i,nombre:r.target.value}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"}),e.jsx("input",{type:"number",placeholder:"Plazo (dias)",value:i.plazo_entrega_dias,onChange:r=>v({...i,plazo_entrega_dias:Number(r.target.value)}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"}),e.jsx("input",{type:"number",placeholder:"Rating (1-5)",min:"1",max:"5",step:"0.5",value:i.rating,onChange:r=>v({...i,rating:Number(r.target.value)}),className:"px-3 py-2 rounded-lg border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{onClick:N,children:"Guardar"}),e.jsx(w,{variant:"ghost",onClick:()=>x(!1),children:"Cancelar"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)] text-left",children:[e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"ID"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Nombre"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)] text-center",children:"Plazo (dias)"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)] text-center",children:"Rating"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)] text-center",children:"Activo"}),e.jsx("th",{className:"px-4 py-3 font-semibold text-[var(--fg)]",children:"Acciones"})]})}),e.jsxs("tbody",{children:[p.map(r=>{const u=j===r.id_proveedor;return e.jsxs("tr",{className:"border-b border-[var(--border)] hover:bg-[var(--bg-hover)]",children:[e.jsx("td",{className:"px-4 py-3 text-[var(--fg)] font-mono",children:r.id_proveedor}),e.jsx("td",{className:"px-4 py-3",children:u?e.jsx("input",{value:c.nombre||"",onChange:s=>g({...c,nombre:s.target.value}),className:"px-2 py-1 rounded border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm w-full"}):e.jsx("span",{className:"text-[var(--fg)]",children:r.nombre})}),e.jsx("td",{className:"px-4 py-3 text-center",children:u?e.jsx("input",{type:"number",value:c.plazo_entrega_dias,onChange:s=>g({...c,plazo_entrega_dias:Number(s.target.value)}),className:"px-2 py-1 rounded border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm w-20 text-center"}):e.jsx("span",{className:"text-[var(--fg)]",children:r.plazo_entrega_dias})}),e.jsx("td",{className:"px-4 py-3 text-center",children:u?e.jsx("input",{type:"number",min:"1",max:"5",step:"0.5",value:c.rating,onChange:s=>g({...c,rating:Number(s.target.value)}),className:"px-2 py-1 rounded border border-[var(--border)] bg-[var(--card)] text-[var(--fg)] text-sm w-16 text-center"}):e.jsxs("span",{className:"text-[var(--fg)]",children:[r.rating,"/5"]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:r.activo?e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[rgba(16,185,129,0.15)] text-[var(--success)] text-xs font-semibold",children:[e.jsx(S,{className:"w-3 h-3"})," Si"]}):e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[rgba(239,68,68,0.15)] text-[var(--danger)] text-xs font-semibold",children:[e.jsx(k,{className:"w-3 h-3"})," No"]})}),e.jsx("td",{className:"px-4 py-3",children:u?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(r.id_proveedor,c),className:"p-1.5 rounded-lg bg-[var(--success)] text-white hover:opacity-80",children:e.jsx(S,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_(null),className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--fg-muted)] hover:bg-[var(--bg-hover)]",children:e.jsx(k,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{_(r.id_proveedor),g({nombre:r.nombre,plazo_entrega_dias:r.plazo_entrega_dias,rating:r.rating,activo:r.activo})},className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--fg-muted)] hover:bg-[var(--bg-hover)] hover:text-[var(--fg)]",children:e.jsx(F,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(r.id_proveedor),className:"p-1.5 rounded-lg bg-[var(--bg-soft)] text-[var(--danger)] hover:bg-[rgba(239,68,68,0.15)]",children:e.jsx(I,{className:"w-4 h-4"})})]})})]},r.id_proveedor)}),p.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-[var(--fg-muted)]",children:"No hay proveedores externos registrados"})})]})]})})]})]})}export{Z as default};
