import{o as T,u as V,b as $,r as h,j as e,B as n,U as F,e as H,v as M,w as U,M as I,P as E,F as R}from"./index-6Zj1ds2M.js";import{s as G}from"./spm-5Es-NbV8.js";import{C as u,a as f,b as g,c as j}from"./Card-CP3YmPNB.js";import{B as J}from"./Badge-CvBA1Bxo.js";import{A as D}from"./Alert-BV_TxNwX.js";import{P as p}from"./PageHeader-Bbn3EATM.js";import{S as q}from"./StatusBadge-8AijpMm0.js";import{b as P,g as z,a as K,f as v}from"./formatters-B3FH-qkk.js";import{A as b}from"./arrow-left-b-KZ7fKy.js";import{H as O}from"./hash-CRYY5MLQ.js";import{C as Q}from"./calendar-CpZdV1lU.js";import{D as B}from"./dollar-sign-DF7jyOsr.js";import"./info-RK52YRAt.js";import"./alert-circle-DENzL0tP.js";import"./x-circle-DQFSXTGC.js";import"./check-circle-ClhsH7zY.js";import"./styleConfig-CWyy-ZH6.js";import"./archive-D_F4Y4lT.js";function i({icon:c,label:l,value:a,className:t=""}){return e.jsxs("div",{className:`flex items-start gap-3 ${t}`,children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-[var(--bg-elevated)] border border-[var(--border)] grid place-items-center flex-shrink-0",children:e.jsx(c,{className:"w-4 h-4 text-[var(--fg-muted)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wider",children:l}),e.jsx("p",{className:"text-sm text-[var(--fg)] mt-0.5 break-words",children:a||"-"})]})]})}function W(){return e.jsxs("div",{className:"space-y-6 animate-pulse",children:[e.jsx("div",{className:"h-8 bg-[var(--bg-soft)] rounded w-1/3"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{className:"h-48 bg-[var(--bg-soft)] rounded-xl"}),e.jsx("div",{className:"h-48 bg-[var(--bg-soft)] rounded-xl"})]}),e.jsx("div",{className:"h-64 bg-[var(--bg-soft)] rounded-xl"})]})}function fe(){const{id:c}=T(),l=V(),{t:a}=$(),[t,y]=h.useState(null),[L,w]=h.useState(!0),[C,N]=h.useState("");if(h.useEffect(()=>{c&&(async()=>{var m,d,o,x;w(!0),N("");try{const r=await G.obtener(c);(m=r.data)!=null&&m.solicitud?y(r.data.solicitud):r.data?y(r.data):N("No se encontró la solicitud")}catch(r){console.error("Error fetching solicitud:",r),N(((x=(o=(d=r.response)==null?void 0:d.data)==null?void 0:o.error)==null?void 0:x.message)||r.message||"Error al cargar la solicitud")}finally{w(!1)}})()},[c]),L)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:a("detalle_loading","Cargando solicitud..."),actions:e.jsxs(n,{variant:"ghost",onClick:()=>l(-1),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),a("common_back","Volver")]})}),e.jsx(W,{})]});if(C)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:a("detalle_error_title","Error"),actions:e.jsxs(n,{variant:"ghost",onClick:()=>l(-1),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),a("common_back","Volver")]})}),e.jsx(D,{variant:"danger",children:C})]});if(!t)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:a("detalle_not_found","Solicitud no encontrada"),actions:e.jsxs(n,{variant:"ghost",onClick:()=>l(-1),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),a("common_back","Volver")]})}),e.jsx(D,{variant:"warning",children:a("detalle_not_found_msg","La solicitud solicitada no existe o fue eliminada.")})]});const _=t.items||[],S=t.estado||t.status||"pendiente",k=t.criticidad||"Normal",A=k.toLowerCase().includes("alta");return e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{title:`${a("detalle_title","Solicitud")} #${t.id}`,actions:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(q,{estado:S}),e.jsxs(n,{variant:"ghost",onClick:()=>l(-1),children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),a("common_back","Volver")]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(g,{children:a("detalle_info_general","Información General")})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx(i,{icon:O,label:a("detalle_id","ID de Solicitud"),value:t.id}),e.jsx(i,{icon:F,label:a("detalle_solicitante","Solicitante"),value:t.id_usuario||t.solicitante}),e.jsx(i,{icon:Q,label:a("detalle_fecha_creacion","Fecha de Creación"),value:P(t.created_at||t.fecha_creacion)}),e.jsx(i,{icon:H,label:a("detalle_fecha_necesidad","Fecha de Necesidad"),value:P(t.fecha_necesidad)}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-[var(--bg-elevated)] border border-[var(--border)] grid place-items-center flex-shrink-0",children:e.jsx(M,{className:`w-4 h-4 ${A?"text-[var(--danger)]":"text-[var(--fg-muted)]"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wider",children:a("detalle_criticidad","Criticidad")}),e.jsx(J,{variant:A?"danger":"default",className:"mt-1 uppercase text-xs font-semibold",children:k})]})]})]})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(g,{children:a("detalle_ubicacion","Ubicación y Costos")})}),e.jsxs(j,{className:"space-y-4",children:[e.jsx(i,{icon:U,label:a("detalle_centro","Centro"),value:t.centro||t.centro_id}),e.jsx(i,{icon:I,label:a("detalle_sector","Sector"),value:z(t.sector||t.sector_id)}),e.jsx(i,{icon:E,label:a("detalle_almacen","Almacén Virtual"),value:K(t.almacen_virtual||t.almacen)}),e.jsx(i,{icon:B,label:a("detalle_centro_costos","Centro de Costos"),value:t.centro_costos}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-[var(--primary-muted)]/20 border border-[var(--primary)]/30 grid place-items-center flex-shrink-0",children:e.jsx(B,{className:"w-4 h-4 text-[var(--primary)]"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium text-[var(--fg-muted)] uppercase tracking-wider",children:a("detalle_monto_total","Monto Total")}),e.jsx("p",{className:"text-lg font-bold text-[var(--primary)] mt-0.5",children:v(t.total_monto||0)})]})]})]})]})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(g,{children:a("detalle_justificacion","Justificación")})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-[var(--bg-elevated)] border border-[var(--border)] grid place-items-center flex-shrink-0",children:e.jsx(R,{className:"w-4 h-4 text-[var(--fg-muted)]"})}),e.jsx("p",{className:"text-sm text-[var(--fg)] leading-relaxed flex-1",children:t.justificacion||a("detalle_sin_justificacion","Sin justificación proporcionada")})]})})]}),e.jsxs(u,{children:[e.jsx(f,{className:"flex flex-row items-center justify-between",children:e.jsxs(g,{children:[a("detalle_materiales","Materiales")," (",_.length,")"]})}),e.jsx(j,{children:_.length===0?e.jsxs("div",{className:"text-center py-8 text-[var(--fg-muted)]",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:a("detalle_sin_items","No hay materiales en esta solicitud")})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-[var(--border)]",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-[var(--fg-muted)]",children:a("detalle_item_codigo","Código")}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-[var(--fg-muted)]",children:a("detalle_item_descripcion","Descripción")}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-[var(--fg-muted)]",children:a("detalle_item_cantidad","Cantidad")}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-[var(--fg-muted)]",children:a("detalle_item_precio","Precio Unit.")}),e.jsx("th",{className:"text-right py-3 px-4 font-medium text-[var(--fg-muted)]",children:a("detalle_item_subtotal","Subtotal")})]})}),e.jsx("tbody",{children:_.map((s,m)=>{const d=Number(s.precio_unitario||s.precio||0),o=Number(s.cantidad||0),x=d*o;return e.jsxs("tr",{className:"border-b border-[var(--border)] last:border-b-0 hover:bg-[var(--bg-elevated)] transition-colors",children:[e.jsx("td",{className:"py-3 px-4 font-mono text-[var(--fg)]",children:s.codigo||s.material_codigo||"-"}),e.jsx("td",{className:"py-3 px-4 text-[var(--fg)]",children:e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"truncate",title:s.descripcion||s.material_descripcion,children:s.descripcion||s.material_descripcion||"-"}),s.comentario&&e.jsx("p",{className:"text-xs text-[var(--fg-muted)] mt-1 truncate",title:s.comentario,children:s.comentario})]})}),e.jsxs("td",{className:"py-3 px-4 text-right font-medium text-[var(--fg)]",children:[o," ",s.unidad||""]}),e.jsx("td",{className:"py-3 px-4 text-right font-mono text-[var(--fg-muted)]",children:v(d)}),e.jsx("td",{className:"py-3 px-4 text-right font-mono font-medium text-[var(--fg)]",children:v(x)})]},m)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"bg-[var(--bg-elevated)]",children:[e.jsxs("td",{colSpan:4,className:"py-3 px-4 text-right font-semibold text-[var(--fg)]",children:[a("detalle_total","Total"),":"]}),e.jsx("td",{className:"py-3 px-4 text-right font-mono font-bold text-lg text-[var(--primary)]",children:v(t.total_monto||0)})]})})]})})})]}),S.toLowerCase()==="borrador"&&e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx(n,{variant:"secondary",onClick:()=>l(`/solicitudes/${t.id}/materiales`),children:a("detalle_btn_editar","Editar Solicitud")})})]})}export{fe as default};
