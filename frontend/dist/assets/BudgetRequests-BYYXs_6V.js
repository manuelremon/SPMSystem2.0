import{u as H,a as Q,b as X,r as s,j as a,B as n,p as G}from"./index-Sv0ImAih.js";import{b as g}from"./spm-CEYuI1MD.js";import{S as V}from"./SearchInput-CkzbeQL0.js";import{C as J,a as K,b as W,d as Y,c as Z}from"./Card-Dxkx64Zs.js";import{D as ee}from"./DataTable-D5Kg2PzX.js";import{S as ae}from"./StatusBadge-WR3bOBfa.js";import{P as re}from"./PageHeader-eKYThyjS.js";import{A as M}from"./Alert-CqYdOks6.js";import{T as se}from"./Skeleton-jl73WAaQ.js";import{f as oe}from"./formatters-Ctz0mOCI.js";import{u as te}from"./useDebounced-BHBN3yOV.js";import{M as R}from"./Modal-DsPy8HQI.js";import{E as ne}from"./eye-CE7LABvj.js";import{C as E}from"./check-circle-C7xi_Sig.js";import{X as D}from"./x-circle-CAJHshED.js";import{P as ie}from"./plus-DCQGzMQZ.js";import"./search-BEsG_P-c.js";import"./inbox-0lzeGquB.js";import"./chevron-up-Dikz9dln.js";import"./styleConfig-C9yLMt_s.js";import"./archive-DdCsdsUn.js";import"./alert-circle-B4RDZmxs.js";const ce=300,le={pendiente:"Pendiente",aprobado_l1:"Aprobado L1",aprobado_l2:"Aprobado L2",aprobado:"Aprobada",rechazado:"Rechazada"},de={L1:"Nivel 1",L2:"Nivel 2",ADMIN:"Admin"};function Le(){const x=H(),{user:me}=Q(),{t:r}=X(),[f,L]=s.useState([]),[j,i]=s.useState(""),[v,C]=s.useState(!1),[y,T]=s.useState(""),N=te(y,ce),[k,u]=s.useState(""),[S,w]=s.useState(!1),[p,P]=s.useState("todas"),[c,b]=s.useState({open:!1,id:null,comentario:""}),[l,h]=s.useState({open:!1,id:null,motivo:""}),d=s.useCallback(async()=>{var e,o,m;C(!0),i("");try{const t={};p==="pendientes"?t.estado="pendiente":p==="aprobadas"?t.estado="aprobado":p==="rechazadas"&&(t.estado="rechazado");const F=(await g.listar(t)).data.requests||[];L(F)}catch(t){i(((m=(o=(e=t.response)==null?void 0:e.data)==null?void 0:o.error)==null?void 0:m.message)||t.message)}finally{C(!1)}},[p]);s.useEffect(()=>{d()},[d]);const q=s.useCallback(async()=>{w(!0),await d(),w(!1)},[d]),B=s.useMemo(()=>{const e=N.trim().toLowerCase();return e?f.filter(o=>String(o.id).includes(e)||(o.justificacion||"").toLowerCase().includes(e)||(o.centro||"").toLowerCase().includes(e)||(o.sector||"").toLowerCase().includes(e)):f},[f,N]),z=s.useCallback(e=>{b({open:!0,id:e,comentario:""})},[]),$=s.useCallback(async()=>{var e,o,m;if(c.id){u(""),i("");try{await g.aprobar(c.id,c.comentario),u(r("bur_aprobada_msg","Solicitud de presupuesto aprobada")),setTimeout(()=>u(""),3e3),d()}catch(t){i(((m=(o=(e=t.response)==null?void 0:e.data)==null?void 0:o.error)==null?void 0:m.message)||t.message)}finally{b({open:!1,id:null,comentario:""})}}},[c.id,c.comentario,d,r]),A=s.useCallback(e=>{h({open:!0,id:e,motivo:""})},[]),I=s.useCallback(async()=>{var o,m,t;if(!l.id)return;u(""),i("");const e=l.motivo.trim();if(e.length<5){i(r("bur_motivo_required","Debe proporcionar un motivo"));return}try{await g.rechazar(l.id,e),u(r("bur_rechazada_msg","Solicitud de presupuesto rechazada")),setTimeout(()=>u(""),3e3),d()}catch(_){i(((t=(m=(o=_.response)==null?void 0:o.data)==null?void 0:m.error)==null?void 0:t.message)||_.message)}finally{h({open:!1,id:null,motivo:""})}},[l.id,l.motivo,d,r]),O=s.useMemo(()=>[{key:"id",header:r("bur_col_id","ID"),sortAccessor:e=>Number(e.id)||0,render:e=>a.jsxs("span",{className:"font-semibold text-[var(--fg)]",children:["#",e.id]})},{key:"centro",header:r("bur_col_centro","Centro"),sortAccessor:e=>e.centro||"",render:e=>e.centro||"-"},{key:"sector",header:r("bur_col_sector","Sector"),sortAccessor:e=>e.sector||"",render:e=>e.sector||"-"},{key:"monto_solicitado_usd",header:r("bur_col_monto","Monto"),sortAccessor:e=>Number(e.monto_solicitado_usd||0),render:e=>a.jsx("span",{className:"font-mono text-sm text-[var(--fg)]",children:oe(e.monto_solicitado_usd)})},{key:"nivel_aprobacion_requerido",header:r("bur_col_nivel","Nivel"),sortAccessor:e=>e.nivel_aprobacion_requerido||"",render:e=>a.jsx("span",{className:"text-xs px-2 py-1 rounded bg-[var(--surface)] text-[var(--fg-muted)]",children:de[e.nivel_aprobacion_requerido]||e.nivel_aprobacion_requerido})},{key:"estado",header:r("bur_col_estado","Estado"),sortAccessor:e=>(e.estado||"").toLowerCase(),render:e=>a.jsx(ae,{estado:le[e.estado]||e.estado})},{key:"acciones",header:r("bur_col_acciones","Acciones"),render:e=>a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsxs(n,{variant:"ghost",className:"px-3 py-1.5 text-xs",onClick:()=>x(`/presupuestos/${e.id}`),children:[a.jsx(ne,{className:"w-3.5 h-3.5 mr-1"}),r("bur_ver","Ver")]}),["pendiente","aprobado_l1","aprobado_l2"].includes(e.estado)&&a.jsxs(a.Fragment,{children:[a.jsxs(n,{className:"px-3 py-1.5 text-xs",onClick:()=>z(e.id),children:[a.jsx(E,{className:"w-3.5 h-3.5 mr-1"}),r("bur_aprobar","Aprobar")]}),a.jsxs(n,{variant:"danger",className:"px-3 py-1.5 text-xs",onClick:()=>A(e.id),children:[a.jsx(D,{className:"w-3.5 h-3.5 mr-1"}),r("bur_rechazar","Rechazar")]})]})]})}],[r,x,z,A]),U=[{key:"todas",label:r("bur_tab_todas","Todas")},{key:"pendientes",label:r("bur_tab_pendientes","Pendientes")},{key:"aprobadas",label:r("bur_tab_aprobadas","Aprobadas")},{key:"rechazadas",label:r("bur_tab_rechazadas","Rechazadas")}];return a.jsxs("div",{className:"space-y-6",children:[a.jsx(re,{title:r("bur_title","SOLICITUDES DE PRESUPUESTO").toUpperCase(),actions:a.jsxs("div",{className:"flex gap-2",children:[a.jsxs(n,{variant:"ghost",onClick:q,disabled:S||v,children:[a.jsx(G,{className:`w-4 h-4 mr-2 ${S?"animate-spin":""}`}),r("common_refresh","Actualizar")]}),a.jsxs(n,{onClick:()=>x("/presupuestos/nueva"),children:[a.jsx(ie,{className:"w-4 h-4 mr-2"}),r("bur_crear","Incorporar Saldo")]})]})}),j&&a.jsx(M,{variant:"danger",onDismiss:()=>i(""),children:j}),k&&a.jsx(M,{variant:"success",onDismiss:()=>u(""),children:k}),a.jsxs(J,{children:[a.jsx(K,{children:a.jsxs("div",{children:[a.jsx(W,{children:r("bur_title","Solicitudes de Presupuesto")}),a.jsx(Y,{children:r("bur_subtitle","Gestiona solicitudes de aumento de presupuesto")})]})}),a.jsxs(Z,{className:"space-y-4",children:[a.jsx("div",{className:"flex gap-1 p-1 bg-[var(--surface)] rounded-lg w-fit",children:U.map(e=>a.jsx("button",{onClick:()=>P(e.key),className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${p===e.key?"bg-[var(--primary)] text-white":"text-[var(--fg-muted)] hover:text-[var(--fg)] hover:bg-[var(--card)]"}`,children:e.label},e.key))}),a.jsxs("div",{className:"flex flex-col md:flex-row gap-3 md:items-center md:justify-between",children:[a.jsx(V,{value:y,onChange:e=>T(e.target.value),placeholder:r("bur_search_placeholder","Buscar por centro, sector o justificacion"),className:"md:max-w-md"}),v&&a.jsx("div",{className:"text-xs font-bold uppercase tracking-[0.05em] text-[var(--fg-muted)]",children:r("bur_loading","Cargando...")})]}),v?a.jsx(se,{rows:5,columns:7}):a.jsx(ee,{columns:O,rows:B,emptyMessage:r("bur_empty","No hay solicitudes de presupuesto")})]})]}),a.jsx(R,{isOpen:c.open,onClose:()=>b({open:!1,id:null,comentario:""}),title:`${r("bur_aprobar","Aprobar")} #${c.id}`,size:"md",footer:a.jsxs(a.Fragment,{children:[a.jsx(n,{variant:"ghost",onClick:()=>b({open:!1,id:null,comentario:""}),children:r("common_cancelar","Cancelar")}),a.jsxs(n,{onClick:$,children:[a.jsx(E,{className:"w-4 h-4 mr-2"}),r("bur_aprobar","Aprobar")]})]}),children:a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm text-[var(--fg-muted)]",children:r("bur_comentario_aprobacion","Comentario (opcional)")}),a.jsx("textarea",{value:c.comentario,onChange:e=>b(o=>({...o,comentario:e.target.value})),rows:3,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:r("bur_comentario_aprobacion","Comentario (opcional)")})]})}),a.jsx(R,{isOpen:l.open,onClose:()=>h({open:!1,id:null,motivo:""}),title:`${r("bur_rechazar","Rechazar")} #${l.id}`,size:"md",footer:a.jsxs(a.Fragment,{children:[a.jsx(n,{variant:"ghost",onClick:()=>h({open:!1,id:null,motivo:""}),children:r("common_cancelar","Cancelar")}),a.jsxs(n,{variant:"danger",onClick:I,children:[a.jsx(D,{className:"w-4 h-4 mr-2"}),r("bur_rechazar","Rechazar")]})]}),children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("label",{className:"text-sm text-[var(--fg-muted)]",children:[r("bur_motivo_rechazo","Motivo de rechazo")," *"]}),a.jsx("textarea",{value:l.motivo,onChange:e=>h(o=>({...o,motivo:e.target.value})),rows:3,className:"w-full px-4 py-3 rounded-lg border border-[var(--border)] bg-[var(--input-bg)] text-sm text-[var(--fg)] focus:ring-2 focus:ring-[var(--primary)] focus:border-[var(--primary)] outline-none transition-all",placeholder:r("bur_motivo_placeholder","Indica el motivo del rechazo...")})]})})]})}export{Le as default};
