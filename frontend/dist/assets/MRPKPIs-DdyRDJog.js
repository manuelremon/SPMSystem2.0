import{c as A,b as K,r as p,d as S,j as e,Q as z,m as u,q as B,e as G,A as L,P as F,v as E,i as W,T as H}from"./index-DSailSuQ.js";import{P as O}from"./PageHeader-YH3gAQyl.js";import{C as v,a as C,b as P,c as b}from"./Card-DuU2GO_U.js";import{C as U}from"./calendar-D_N9CON9.js";import{L as q}from"./loader-2-DH2yhz0D.js";import{A as $}from"./alert-circle-7AkYIq0l.js";import{T as Q}from"./trending-down-Br6LoJAz.js";const V=A("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),Z=A("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),J=A("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]),D=A("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);function X({titulo:t,valor:x,unidad:i,tendencia:a,objetivo:l,descripcion:s,icon:c}){const d={up:{icon:H,color:"text-green-400",bg:"bg-green-500/10"},down:{icon:Q,color:"text-red-400",bg:"bg-red-500/10"},stable:{icon:Z,color:"text-yellow-400",bg:"bg-yellow-500/10"}},n=d[a]||d.stable,m=n.icon;return a==="up"&&!(s!=null&&s.includes("vencidos"))&&!(s!=null&&s.includes("tiempo"))||a==="down"&&(s!=null&&s.includes("vencidos")||(s==null||s.includes("tiempo"))),e.jsx(v,{className:"hover:border-[var(--primary)]/50 transition-all duration-300",children:e.jsxs(b,{className:"p-5",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:u("p-2.5 rounded-xl",n.bg),children:e.jsx(c,{className:u("w-5 h-5",n.color)})}),e.jsxs("div",{className:u("flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium",n.bg,n.color),children:[e.jsx(m,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:a==="up"?"Subiendo":a==="down"?"Bajando":"Estable"})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-[var(--fg)]",children:x}),e.jsx("span",{className:"text-lg text-[var(--fg-muted)] ml-1",children:i})]}),e.jsx("h3",{className:"text-sm font-semibold text-[var(--fg)] mb-1",children:t}),e.jsx("p",{className:"text-xs text-[var(--fg-muted)]",children:s}),l&&e.jsx("div",{className:"mt-3 pt-3 border-t border-[var(--border)]",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-[var(--fg-muted)]",children:"Objetivo:"}),e.jsxs("span",{className:u("font-medium",x<=l?"text-green-400":"text-red-400"),children:[l," ",i]})]})})]})})}function Y({data:t,size:x=200}){const i=t.reduce((s,c)=>s+c.valor,0);let a=0;const l=(s,c,d)=>{const n=(s-90)*(Math.PI/180),m=(c-90)*(Math.PI/180),h=80,f=100,g=100,N=f+h*Math.cos(n),y=g+h*Math.sin(n),w=f+h*Math.cos(m),_=g+h*Math.sin(m),k=c-s>180?1:0;return`M ${f} ${g} L ${N} ${y} A ${h} ${h} 0 ${k} 1 ${w} ${_} Z`};return e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("svg",{viewBox:"0 0 200 200",className:"w-48 h-48",children:[t.map((s,c)=>{const d=s.valor/i*360,n=l(a,a+d,s.color);return a+=d,e.jsx("path",{d:n,fill:s.color,className:"transition-all duration-300 hover:opacity-80"},c)}),e.jsx("circle",{cx:"100",cy:"100",r:"50",fill:"var(--bg)"}),e.jsx("text",{x:"100",y:"95",textAnchor:"middle",className:"text-sm fill-[var(--fg-muted)]",children:"Total"}),e.jsxs("text",{x:"100",y:"115",textAnchor:"middle",className:"text-2xl font-bold fill-[var(--fg)]",children:[i.toFixed(0),"%"]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:t.map((s,c)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s.color}}),e.jsx("span",{className:"text-sm text-[var(--fg)]",children:s.nombre}),e.jsxs("span",{className:"text-sm font-medium text-[var(--fg-muted)]",children:[s.valor.toFixed(1),"%"]})]},c))})]})}function ee({data:t,height:x=200}){const i=Math.max(...t.map(a=>Math.max(a.alertas,a.resueltas)));return e.jsx("div",{className:"flex items-end gap-4 justify-between",style:{height:x},children:t.map((a,l)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1",children:[e.jsxs("div",{className:"flex gap-1 items-end h-full",children:[e.jsx("div",{className:"w-4 bg-red-400/80 rounded-t transition-all duration-500",style:{height:`${a.alertas/i*100}%`},title:`Alertas: ${a.alertas}`}),e.jsx("div",{className:"w-4 bg-green-400/80 rounded-t transition-all duration-500",style:{height:`${a.resueltas/i*100}%`},title:`Resueltas: ${a.resueltas}`})]}),e.jsx("span",{className:"text-xs text-[var(--fg-muted)] rotate-0 whitespace-nowrap",children:new Date(a.fecha).toLocaleDateString("es",{day:"2-digit",month:"short"})})]},l))})}function se({value:t,max:x=100,label:i}){const a=Math.min(t/x*100,100),l=a/100*180-90,s=()=>a>=80?"#22c55e":a>=50?"#eab308":"#ef4444";return e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("svg",{viewBox:"0 0 200 120",className:"w-40 h-24",children:[e.jsx("path",{d:"M 20 100 A 80 80 0 0 1 180 100",fill:"none",stroke:"var(--border)",strokeWidth:"16",strokeLinecap:"round"}),e.jsx("path",{d:"M 20 100 A 80 80 0 0 1 180 100",fill:"none",stroke:s(),strokeWidth:"16",strokeLinecap:"round",strokeDasharray:`${a*2.51} 251`,className:"transition-all duration-1000"}),e.jsx("line",{x1:"100",y1:"100",x2:100+60*Math.cos(l*Math.PI/180),y2:100+60*Math.sin(l*Math.PI/180),stroke:"var(--fg)",strokeWidth:"3",strokeLinecap:"round",className:"transition-all duration-1000"}),e.jsx("circle",{cx:"100",cy:"100",r:"6",fill:"var(--fg)"})]}),e.jsxs("div",{className:"text-center mt-2",children:[e.jsxs("span",{className:"text-2xl font-bold",style:{color:s()},children:[t,"%"]}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:i})]})]})}function oe(){var g,N,y,w,_,k;const{t}=K(),[x,i]=p.useState(!0),[a,l]=p.useState(null),[s,c]=p.useState(null),[d,n]=p.useState("mes"),m=p.useCallback(async()=>{var r,o,M,I,T,R;i(!0),l(null);try{const j=await S.get(`/mrp/kpis?periodo=${d}`);(r=j.data)!=null&&r.ok?c(j.data):l(((M=(o=j.data)==null?void 0:o.error)==null?void 0:M.message)||"Error al cargar KPIs")}catch(j){l(((R=(T=(I=j.response)==null?void 0:I.data)==null?void 0:T.error)==null?void 0:R.message)||"Error de conexión")}finally{i(!1)}},[d]);p.useEffect(()=>{m()},[m]);const h={materiales_en_riesgo:E,materiales_sobrestock:F,rotacion_promedio:L,lead_time_promedio:G,cumplimiento_mrp:D,pedidos_vencidos:$,pct_pedidos_vencidos:$,velocidad_respuesta:V},f=[{value:"mes",label:"Último Mes"},{value:"trimestre",label:"Último Trimestre"},{value:"anio",label:"Último Año"}];return e.jsxs(z,{children:[e.jsx(O,{title:t("mrp_kpis_titulo","KPI's MRP"),subtitle:t("mrp_kpis_subtitulo","Métricas inteligentes sobre el comportamiento del MRP")}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-[var(--primary)]"}),e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:"Período:"}),e.jsx("div",{className:"flex gap-1",children:f.map(r=>e.jsx("button",{onClick:()=>n(r.value),className:u("px-3 py-1.5 rounded-lg text-sm font-medium transition-all",d===r.value?"bg-[var(--primary)] text-[var(--on-primary)]":"bg-[var(--surface)] text-[var(--fg-muted)] hover:bg-[var(--bg-elevated)]"),children:r.label},r.value))})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2 bg-[var(--surface)] border border-[var(--border)] rounded-lg hover:bg-[var(--bg-elevated)] transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),t("mrp_actualizar","Actualizar")]})]}),x?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsx(q,{className:"w-8 h-8 animate-spin text-[var(--primary)]"})}):a?e.jsxs("div",{className:"flex items-center justify-center py-24 text-red-400",children:[e.jsx($,{className:"w-6 h-6 mr-2"}),a]}):s?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:Object.entries(s.kpis||{}).map(([r,o])=>e.jsx(X,{titulo:r.replace(/_/g," ").replace(/\b\w/g,M=>M.toUpperCase()),valor:o.valor,unidad:o.unidad,tendencia:o.tendencia,objetivo:o.objetivo,descripcion:o.descripcion,icon:h[r]||W},r))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-[var(--primary)]"}),t("mrp_distribucion_estados","Distribución de Estados")]})}),e.jsx(b,{className:"flex items-center justify-center py-6",children:((g=s.graficos)==null?void 0:g.distribucion_estados)&&e.jsx(Y,{data:s.graficos.distribucion_estados})})]}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-[var(--primary)]"}),t("mrp_cumplimiento","Cumplimiento MRP")]})}),e.jsx(b,{className:"flex items-center justify-center py-6",children:e.jsx(se,{value:((y=(N=s.kpis)==null?void 0:N.cumplimiento_mrp)==null?void 0:y.valor)||0,label:"Nivel de Cumplimiento"})})]})]}),e.jsxs(v,{className:"mb-8",children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-[var(--primary)]"}),t("mrp_evolucion_alertas","Evolución de Alertas")]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded"}),e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:"Alertas Generadas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded"}),e.jsx("span",{className:"text-sm text-[var(--fg-muted)]",children:"Alertas Resueltas"})]})]}),((w=s.graficos)==null?void 0:w.evolucion_alertas)&&e.jsx(ee,{data:s.graficos.evolucion_alertas,height:180})]})]}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-[var(--primary)]"}),t("mrp_top_riesgo","Top Materiales en Riesgo")]})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-3",children:(k=(_=s.graficos)==null?void 0:_.top_materiales_riesgo)==null?void 0:k.map((r,o)=>e.jsxs("div",{className:u("flex items-center justify-between p-3 rounded-lg","bg-[var(--surface)] border border-[var(--border)]","hover:border-[var(--primary)]/30 transition-all"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:u("w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm",o===0?"bg-red-500/20 text-red-400":o===1?"bg-yellow-500/20 text-yellow-400":"bg-orange-500/20 text-orange-400"),children:o+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-mono text-[var(--primary)]",children:r.codigo}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)]",children:r.descripcion})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-lg font-bold text-red-400",children:[r.dias_sin_stock," días"]}),e.jsx("p",{className:"text-xs text-[var(--fg-muted)]",children:"sin stock"})]})]},r.codigo))})})]}),e.jsx("div",{className:"mt-6 p-4 bg-[var(--surface)] rounded-lg border border-[var(--border)]",children:e.jsxs("div",{className:"flex items-center gap-4 text-sm text-[var(--fg-muted)]",children:[e.jsxs("span",{children:[e.jsx("strong",{className:"text-[var(--fg)]",children:"Período:"})," ",s.fecha_inicio," a ",s.fecha_fin]}),e.jsxs("span",{children:[e.jsx("strong",{className:"text-[var(--fg)]",children:"Total materiales:"})," ",s.total_materiales]})]})})]}):null]})}export{oe as default};
