import{c as O,b as I,a as ee,r as l,d as w,j as e,B as x,e as se,h as re,n as ae,w as te}from"./index-CU87sTKb.js";import{C as v,a as q,b as B,c as j}from"./Card-Dv3_2QFE.js";import{M as z}from"./message-circle-BFyIpPaZ.js";import{P as K}from"./plus-UtIt5hbI.js";import{S as le}from"./search-DiDyVzER.js";import{H as oe}from"./hash-CQltLjUA.js";import{A as ne}from"./alert-circle-D7STJzyn.js";import{C as ie}from"./chevron-up-BFuCrXiR.js";const ce=O("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),de=O("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);function Ne(){const{t:me}=I(),{user:xe}=ee(),[c,Q]=l.useState([]),[G,P]=l.useState(!0),[L,Z]=l.useState(null),[$,N]=l.useState(!1),[t,y]=l.useState({titulo:"",contenido:"",categoria:"general"}),[E,M]=l.useState(!1),[J,V]=l.useState({}),[f,D]=l.useState({}),[n,k]=l.useState(""),[a,p]=l.useState(null),g=[{id:"general",label:"General",color:"var(--primary)"},{id:"ayuda",label:"Ayuda",color:"var(--info)"},{id:"sugerencias",label:"Sugerencias",color:"var(--success)"},{id:"problemas",label:"Problemas",color:"var(--danger)"},{id:"anuncios",label:"Anuncios",color:"var(--warning)"}],u=l.useCallback(async()=>{P(!0);try{const s=await w.get("/foro/posts");s.data.ok&&Q(s.data.posts||[])}catch(s){console.error("Error loading posts",s),Z("No se pudieron cargar las publicaciones")}finally{P(!1)}},[]);l.useEffect(()=>{u()},[u]);const W=async s=>{if(s.preventDefault(),!(!t.titulo.trim()||!t.contenido.trim())){M(!0);try{(await w.post("/foro/posts",t)).data.ok&&(y({titulo:"",contenido:"",categoria:"general"}),N(!1),u())}catch(r){console.error("Error creating post",r)}finally{M(!1)}}},X=async s=>{try{await w.post(`/foro/posts/${s}/like`),u()}catch(r){console.error("Error liking post",r)}},A=async s=>{const r=f[s];if(r!=null&&r.trim())try{await w.post(`/foro/posts/${s}/respuestas`,{contenido:r}),D({...f,[s]:""}),u()}catch(i){console.error("Error replying to post",i)}},Y=s=>{V(r=>({...r,[s]:!r[s]}))},H=s=>{if(!s)return"";const r=new Date(s),d=new Date-r,m=Math.floor(d/6e4),h=Math.floor(m/60),b=Math.floor(h/24);return m<1?"Ahora mismo":m<60?`Hace ${m} min`:h<24?`Hace ${h}h`:b<7?`Hace ${b} dias`:r.toLocaleDateString("es-AR",{day:"2-digit",month:"short"})},S=s=>{var r;return((r=g.find(i=>i.id===s))==null?void 0:r.color)||"var(--fg-muted)"},_=s=>{var r;return((r=g.find(i=>i.id===s))==null?void 0:r.label)||s},C=c.filter(s=>{var d;const r=n.trim()===""||s.titulo.toLowerCase().includes(n.toLowerCase())||s.contenido.toLowerCase().includes(n.toLowerCase())||((d=s.autor_nombre)==null?void 0:d.toLowerCase().includes(n.toLowerCase())),i=a===null||s.categoria===a;return r&&i}),U=s=>c.filter(r=>r.categoria===s).length;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-[var(--fg)] flex items-center gap-2",children:[e.jsx(z,{className:"w-7 h-7 text-[var(--primary)]"}),"Foro SPM"]}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)] mt-1",children:"Comparte ideas, resuelve dudas y conecta con tus companeros"})]}),e.jsxs(x,{onClick:()=>N(!$),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Nueva Publicacion"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-[var(--fg-subtle)]"}),e.jsx("input",{type:"text",value:n,onChange:s=>k(s.target.value),placeholder:"Buscar publicaciones por titulo, contenido o autor...",className:"w-full pl-10 pr-4 py-3 rounded-lg bg-[var(--bg-soft)] border border-[var(--border)] text-[var(--fg)] placeholder:text-[var(--fg-subtle)] focus:outline-none focus:border-[var(--primary)] transition-colors"}),n&&e.jsx("button",{onClick:()=>k(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-[var(--fg-subtle)] hover:text-[var(--fg)] transition-colors",children:e.jsx("span",{className:"text-lg",children:"Ã—"})})]}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("aside",{className:"w-56 flex-shrink-0 hidden lg:block",children:e.jsxs(v,{className:"sticky top-4",children:[e.jsx(q,{className:"pb-2",children:e.jsxs(B,{className:"text-sm flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Categorias"]})}),e.jsx(j,{className:"pt-0",children:e.jsxs("nav",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>p(null),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors ${a===null?"bg-[var(--primary)]/10 text-[var(--primary)] font-medium":"text-[var(--fg-muted)] hover:bg-[var(--bg-elevated)] hover:text-[var(--fg)]"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-4 h-4"}),"Todos"]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[var(--bg-elevated)]",children:c.length})]}),g.map(s=>e.jsxs("button",{onClick:()=>p(s.id===a?null:s.id),className:`w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm transition-colors ${a===s.id?"font-medium":"text-[var(--fg-muted)] hover:bg-[var(--bg-elevated)] hover:text-[var(--fg)]"}`,style:{backgroundColor:a===s.id?`${s.color}15`:void 0,color:a===s.id?s.color:void 0},children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:s.color}}),s.label]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-[var(--bg-elevated)]",children:U(s.id)})]},s.id))]})})]})}),e.jsxs("main",{className:"flex-1 min-w-0 space-y-4",children:[$&&e.jsxs(v,{className:"border-[var(--primary)]/30",children:[e.jsx(q,{className:"pb-2",children:e.jsx(B,{className:"text-base",children:"Nueva Publicacion"})}),e.jsx(j,{children:e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:"Titulo"}),e.jsx("input",{type:"text",value:t.titulo,onChange:s=>y({...t,titulo:s.target.value}),placeholder:"Escribe un titulo descriptivo...",className:"w-full px-4 py-2.5 rounded-lg bg-[var(--bg-soft)] border border-[var(--border)] text-[var(--fg)] placeholder:text-[var(--fg-subtle)] focus:outline-none focus:border-[var(--primary)] transition-colors",maxLength:100})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:"Categoria"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(s=>e.jsx("button",{type:"button",onClick:()=>y({...t,categoria:s.id}),className:`px-3 py-1.5 rounded-full text-xs font-semibold border transition-all ${t.categoria===s.id?"border-transparent text-white":"border-[var(--border)] text-[var(--fg-muted)] hover:border-[var(--primary)]"}`,style:{backgroundColor:t.categoria===s.id?s.color:"transparent"},children:s.label},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-[var(--fg-muted)] mb-1",children:"Contenido"}),e.jsx("textarea",{value:t.contenido,onChange:s=>y({...t,contenido:s.target.value}),placeholder:"Describe tu pregunta, idea o comentario...",rows:4,className:"w-full px-4 py-2.5 rounded-lg bg-[var(--bg-soft)] border border-[var(--border)] text-[var(--fg)] placeholder:text-[var(--fg-subtle)] focus:outline-none focus:border-[var(--primary)] transition-colors resize-none",maxLength:2e3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{type:"button",variant:"ghost",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(x,{type:"submit",disabled:E||!t.titulo.trim()||!t.contenido.trim(),children:E?"Publicando...":"Publicar"})]})]})})]}),G?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-[var(--primary)] mx-auto"}),e.jsx("p",{className:"text-[var(--fg-muted)] mt-4",children:"Cargando publicaciones..."})]}):L?e.jsx(v,{className:"border-[var(--danger)]/30",children:e.jsxs(j,{className:"py-8 text-center",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-3 text-[var(--danger)]"}),e.jsx("p",{className:"text-[var(--fg-muted)]",children:L}),e.jsx(x,{variant:"outline",onClick:u,className:"mt-4",children:"Reintentar"})]})}):C.length===0?e.jsx(v,{children:e.jsxs(j,{className:"py-12 text-center",children:[e.jsx(z,{className:"w-16 h-16 mx-auto mb-4 text-[var(--fg-subtle)] opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold text-[var(--fg)] mb-2",children:c.length===0?"No hay publicaciones aun":"No se encontraron resultados"}),e.jsx("p",{className:"text-[var(--fg-muted)] mb-4",children:c.length===0?"Se el primero en iniciar una conversacion!":"Intenta con otros terminos de busqueda o categoria"}),c.length===0&&e.jsxs(x,{onClick:()=>N(!0),children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Crear primera publicacion"]}),(n||a)&&e.jsx(x,{variant:"outline",onClick:()=>{k(""),p(null)},children:"Limpiar filtros"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 lg:hidden",children:[e.jsxs("button",{onClick:()=>p(null),className:`px-3 py-1.5 rounded-full text-xs font-semibold border transition-all ${a===null?"bg-[var(--primary)] text-white border-transparent":"border-[var(--border)] text-[var(--fg-muted)] hover:border-[var(--primary)]"}`,children:["Todos (",c.length,")"]}),g.map(s=>e.jsxs("button",{onClick:()=>p(s.id===a?null:s.id),className:`px-3 py-1.5 rounded-full text-xs font-semibold border transition-all ${a===s.id?"border-transparent text-white":"border-[var(--border)] text-[var(--fg-muted)] hover:border-[var(--primary)]"}`,style:{backgroundColor:a===s.id?s.color:"transparent"},children:[s.label," (",U(s.id),")"]},s.id))]}),(n||a)&&e.jsxs("p",{className:"text-sm text-[var(--fg-muted)]",children:[C.length," resultado",C.length!==1?"s":"",a&&` en ${_(a)}`,n&&` para "${n}"`]}),C.map(s=>{var d,m,h,b,R;const r=J[s.id],i=s.respuestas&&s.respuestas.length>0;return e.jsx(v,{className:"hover:border-[var(--primary)]/30 transition-colors",children:e.jsxs(j,{className:"p-5",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full grid place-items-center flex-shrink-0 text-white font-bold text-sm",style:{backgroundColor:S(s.categoria)},children:((m=(d=s.autor_nombre)==null?void 0:d[0])==null?void 0:m.toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-[var(--fg)]",children:s.autor_nombre}),e.jsx("span",{className:"px-2 py-0.5 rounded-full text-[10px] font-bold uppercase",style:{backgroundColor:`${S(s.categoria)}20`,color:S(s.categoria)},children:_(s.categoria)}),e.jsxs("span",{className:"text-xs text-[var(--fg-subtle)] flex items-center gap-1",children:[e.jsx(se,{className:"w-3 h-3"}),H(s.created_at)]})]}),e.jsx("h3",{className:"font-semibold text-[var(--fg)] mt-1",children:s.titulo}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)] mt-2 whitespace-pre-wrap",children:s.contenido})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-3 border-t border-[var(--border)]",children:[e.jsxs("button",{onClick:()=>X(s.id),className:`flex items-center gap-1.5 text-sm transition-colors ${s.user_liked?"text-[var(--primary)]":"text-[var(--fg-muted)] hover:text-[var(--primary)]"}`,children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:s.likes||0})]}),e.jsxs("button",{onClick:()=>Y(s.id),className:"flex items-center gap-1.5 text-sm text-[var(--fg-muted)] hover:text-[var(--primary)] transition-colors",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsxs("span",{children:[((h=s.respuestas)==null?void 0:h.length)||0," respuestas"]}),i&&(r?e.jsx(ie,{className:"w-3 h-3"}):e.jsx(ae,{className:"w-3 h-3"}))]})]}),r&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-[var(--border)] space-y-4",children:[(b=s.respuestas)==null?void 0:b.map(o=>{var T,F;return e.jsxs("div",{className:"flex gap-3 pl-4 border-l-2 border-[var(--border)]",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[var(--bg-elevated)] grid place-items-center flex-shrink-0 text-[var(--fg-muted)] text-xs font-bold",children:((F=(T=o.autor_nombre)==null?void 0:T[0])==null?void 0:F.toUpperCase())||"U"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--fg)]",children:o.autor_nombre}),e.jsx("span",{className:"text-xs text-[var(--fg-subtle)]",children:H(o.created_at)})]}),e.jsx("p",{className:"text-sm text-[var(--fg-muted)] mt-1",children:o.contenido})]})]},o.id)}),e.jsxs("div",{className:"flex gap-2 pl-4",children:[e.jsx("input",{type:"text",value:f[s.id]||"",onChange:o=>D({...f,[s.id]:o.target.value}),placeholder:"Escribe una respuesta...",className:"flex-1 px-3 py-2 rounded-lg bg-[var(--bg-soft)] border border-[var(--border)] text-sm text-[var(--fg)] placeholder:text-[var(--fg-subtle)] focus:outline-none focus:border-[var(--primary)] transition-colors",onKeyDown:o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),A(s.id))}}),e.jsx(x,{size:"sm",onClick:()=>A(s.id),disabled:!((R=f[s.id])!=null&&R.trim()),children:e.jsx(te,{className:"w-4 h-4"})})]})]})]})},s.id)})]})]})]})]})}export{Ne as default};
